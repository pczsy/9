<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修pymssql的Connection相关特性浅析' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>pymssql的Connection相关特性浅析</center></div><div class='banquan'>原文出处:本文由博客园博主潇湘隐者提供。<br/>
原文连接:https://www.cnblogs.com/kerrycode/p/11419016.html</div><br>
    <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><font color="#000000"><font face="宋体"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font style="font-size: 10.5pt">关于Python的pymssql模块,之前研究时总结了</font></span><font style="font-size: 10.5pt"><span style="line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn; mso-ascii-font-family: 宋体; mso-fareast-font-family: 宋体">“<a href="https://www.cnblogs.com/kerrycode/p/11391832.html" target="_blank">pymssql默认关闭自动模式开启事务行为浅析</a></span><span style="line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn; mso-ascii-font-family: 宋体; mso-fareast-font-family: 宋体">”</span></font><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font style="font-size: 10.5pt">这篇博客，但是在测试过程中又发现了几个问题，下面对这些问题做一些浅析，如有不足或不正确的地方，敬请指出。</font></span></font></font></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><font color="#000000"><font face="宋体"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"></span></font></font>&nbsp;</p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"><strong>1： pymssql的commit函数可以提交两次或多次</strong></font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><font color="#000000"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt">Connection.commit()</font></font></span><span style="font-family: ; line-height: normal; mso-hansi-font-family: &quot;Courier New&quot;; mso-bidi-font-family: &quot;Courier New&quot;; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-ascii-font-family: &quot;Courier New&quot;"><font face="宋体"><font style="font-size: 12pt">：</font></font></span></font><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 24pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 30pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt" color="#000000">Commit current transaction. You must call this method to persist your data if you leave autocommit at its default value, which is False</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 30pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 24pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><span style="line-height: normal; mso-tab-count: 1"><font face="Times New Roman"><font style="font-size: 12pt" color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></font></span></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">我们知道pymssql模块里面有commit函数表示提交事务，由于某个特殊原因，测试过程中发现执行多次commit都OK，不会报错，如下代码所示。</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4"> <div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># -*- coding: utf-8 -*-</span></pre><!--CRLF--><pre><code><span style="color: #006080">''</span><span style="color: #006080">'</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">-------------------------------------------------------------------------------------------</pre><!--CRLF--><pre><code>--&nbsp; Script Name&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp; TranTest.py</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">-------------------------------------------------------------------------------------------</pre><!--CRLF--><pre><code>'</span><span style="color: #006080">''</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import pymssql</pre><!--CRLF--><pre><code>import logging</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import os.path</pre><!--CRLF--><pre><code>import os</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import base64</pre><!--CRLF--><pre><code>from cryptography.fernet import Fernet</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>key=bytes(os.environ.get(<span style="color: #006080">'key'</span>),encoding=<span style="color: #006080">"utf8"</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">cipher_suite = Fernet(key)</pre><!--CRLF--><pre><code>with open(<span style="color: #006080">'/home/konglb/python/conf/ms_db_conf.bin'</span>, <span style="color: #006080">'rb'</span>) <span style="color: #0000ff">as</span> file_object:</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">for</span> line in file_object:</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; encryptedpwd = line</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">decrypt_pwd = (cipher_suite.decrypt(encryptedpwd))</pre><!--CRLF--><pre><code>password_decrypted = bytes(decrypt_pwd).decode(<span style="color: #006080">"utf-8"</span>) <span style="color: #008000">#convert to string</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">env_db_user=os.environ.get(<span style="color: #006080">'db_user'</span>)</pre><!--CRLF--><pre><code>db_user=base64.b64decode(bytes(env_db_user, encoding=<span style="color: #006080">"utf8"</span>))</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">dest_db_conn = pymssql.connect(host=os.environ.get(<span style="color: #006080">'db_host'</span>),</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user=bytes.decode(db_user),</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; password=password_decrypted,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=<span style="color: #006080">'master'</span>,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; charset=<span style="color: #006080">"utf8"</span>);</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">sub_cursor = dest_db_conn.cursor(as_dict=True)</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>sub_cursor.execute(<span style="color: #006080">'SELECT COUNT(*) AS RecordNum FROM msdb.dbo.sysmail_account'</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">result_rows =sub_cursor.fetchone()</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #0000ff">print</span>(result_rows[<span style="color: #006080">"RecordNum"</span>])</pre><!--CRLF--><pre><code>dest_db_conn.commit()</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">dest_db_conn.commit()</pre><!--CRLF--><pre><code>dest_db_conn.close()</pre><!--CRLF--></div></div>
<p class="MsoNormal" style="background: white; word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><i><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 9pt" color="#808080">&nbsp;</font></font></span></i></p>
<p class="MsoNormal" style="background: white; word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><i><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 9pt" color="#808080">&nbsp;</font></font></span></i></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">其实我们用SQL Profile跟踪一下就会知道，多执行一次commit，相当于在SQL Server数据库多执行了一次下面SQL，显然不会出现什么问题，但是也没有什么用处，所以这个应该只提交一次就OK了。这个问题，其实一开始对于我来说还有点震惊。了解过原理后，其实发现也就那么一回事。如果你是驱动的开发者而言，也不可能让第二次commit报错，如果这样的话，那么程序的健壮性就有问题了。</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><font face="新宋体"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font color="#0000ff"><font style="font-size: 10pt">BEGIN</font></font></span><span lang="X-NONE" style="font-family: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font style="font-size: 10pt"><font color="#000000"> </font></font><span style="color: ; line-height: normal"><font style="font-size: 10pt" color="#0000ff">TRAN</font></span></span></font></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font face="新宋体"><span style="line-height: normal; mso-tab-count: 1"><font color="#000000"><font style="font-size: 10pt">&nbsp;&nbsp;&nbsp; </font></font></span><font style="font-size: 10pt"><span style="color: ; line-height: normal"><font color="#0000ff">COMMIT</font></span><font color="#000000"> </font><span style="color: ; line-height: normal"><font color="#0000ff">TRAN</font></span></font><span style="color: ; line-height: normal"><font style="font-size: 10pt" color="#808080">;</font></span></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><a href="https://img2018.cnblogs.com/blog/73542/201908/73542-20190827161442315-1964386253.png"><img title="clip_image001" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image001" src="./images/pymssql的Connection相关特性浅析0.png" width="652" height="208"></a></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font face="新宋体"><font style="font-size: 10pt" color="#808080">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font face="新宋体"><font style="font-size: 10pt" color="#808080">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"><strong>2: pymssql的close函数可以关闭多次？</strong></font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 30pt; mso-layout-grid-align: none" align="left"><font color="#000000"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt">Connection.close()<span style="line-height: normal; mso-spacerun: yes">&nbsp; </span></font></font></span><font style="font-size: 12pt"><span style="font-family: ; line-height: normal; mso-hansi-font-family: &quot;Courier New&quot;; mso-bidi-font-family: &quot;Courier New&quot;; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-ascii-font-family: &quot;Courier New&quot;"><font face="宋体">：</font></span></font><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt">Close the connection</font></font></span></font></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 30pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 12pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><font color="#000000"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt">关于pymssql中的close函数表示关闭数据库连接，第一次执行就已经关闭了数据库连接，执行第二次close没有报任何错误，但是如果在连接关闭后，再执行查询之类的操作，就会报</font></font></span><font style="font-size: 10.5pt"><span style="line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn; mso-ascii-font-family: 宋体; mso-fareast-font-family: 宋体"><font face="等线">“</font></span><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体">pymssql.InterfaceError: Connection is closed</font></span><span style="line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn; mso-ascii-font-family: 宋体; mso-fareast-font-family: 宋体"><font face="等线">”</font></span></font><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt">这类错误，如下所示，简单修改上面代码，就可以测试、验证：</font></font></span></font></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="background: white; word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000"><font style="font-size: 11pt">dest_db_conn.commit()<br>dest_db_conn.close()<br>sub_cursor.execute(</font></font></span><font style="font-size: 11pt"><b><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#008080">'SELECT COUNT(*) AS RecordNum FROM msdb.dbo.sysmail_account'</font></span></b></font></font><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 11pt" color="#000000">)<br>dest_db_conn.close()</font></font><br style="mso-special-character: line-break"><br style="mso-special-character: line-break"></span></p>
<p class="MsoNormal" style="background: white; word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 9pt" color="#000000">&nbsp;</font></font></span></p>
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000">#python TranTest.py </span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>Traceback (most recent call last):</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp; File <span style="color: #006080">"TranTest.py"</span>, line 45, <span style="color: #0000ff">in</span> &lt;module&gt;</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp; sub_cursor.execute(<span style="color: #006080">'SELECT COUNT(*) AS RecordNum FROM msdb.dbo.sysmail_account'</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp; File <span style="color: #006080">"src/pymssql.pyx"</span>, line 448, <span style="color: #0000ff">in</span> pymssql.Cursor.execute</pre><!--CRLF--><pre><code>&nbsp; File <span style="color: #006080">"src/pymssql.pyx"</span>, line 238, <span style="color: #0000ff">in</span> pymssql.Connection._conn.__get__</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">pymssql.InterfaceError: Connection is closed.</pre><!--CRLF--></div></div>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><font color="#000000"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt">个人猜测驱动程序已经关闭数据库链接了，第二次执行close函数时，可能驱动底层检测到数据库连接已经关闭，直接退出了，不做任何操作。但是如果数据库连接关闭后，再去执行相关SQL，此时就会报</font></font></span><font style="font-size: 10.5pt"><span style="line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn; mso-ascii-font-family: 宋体; mso-fareast-font-family: 宋体"><font face="等线">“</font></span><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体">Connection is closed</font></span><span style="line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn; mso-ascii-font-family: 宋体; mso-fareast-font-family: 宋体"><font face="等线">”</font></span></font><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt">这类错误了。</font></font></span></font></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"><strong>3： 如果忘记提交或回滚事务，那么脚本执行完成后会回滚吗？ 什么时候回滚呢？ 另外，它会阻塞其它会话吗？ 阻塞的时间有多长？</strong></font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"></span><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体">
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000"># -*- coding: utf-8 -*-</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #006080">''</span><span style="color: #006080">'</pre><!--CRLF--><pre><code>-------------------------------------------------------------------------------------------</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">--&nbsp; Script Name&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp; TranTest.py</pre><!--CRLF--><pre><code>-------------------------------------------------------------------------------------------</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">'</span><span style="color: #006080">''</span></pre><!--CRLF--><pre><code>import pymssql</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import logging</pre><!--CRLF--><pre><code>import os.path</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import os</pre><!--CRLF--><pre><code>import base64</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">from cryptography.fernet import Fernet</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">key=bytes(os.environ.get(<span style="color: #006080">'key'</span>),encoding=<span style="color: #006080">"utf8"</span>)</pre><!--CRLF--><pre><code>cipher_suite = Fernet(key)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">with open(<span style="color: #006080">'/home/konglb/python/conf/ms_db_conf.bin'</span>, <span style="color: #006080">'rb'</span>) as file_object:</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">for</span> line <span style="color: #0000ff">in</span> file_object:</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; encryptedpwd = line</pre><!--CRLF--><pre><code>decrypt_pwd = (cipher_suite.decrypt(encryptedpwd))</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">password_decrypted = bytes(decrypt_pwd).decode(<span style="color: #006080">"utf-8"</span>) <span style="color: #008000">#convert to string</span></pre><!--CRLF--><pre><code>env_db_user=os.environ.get(<span style="color: #006080">'db_user'</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">db_user=base64.b64decode(bytes(env_db_user, encoding=<span style="color: #006080">"utf8"</span>))</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>dest_db_conn = pymssql.connect(host=os.environ.get(<span style="color: #006080">'db_host'</span>),</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user=bytes.decode(db_user),</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; password=password_decrypted,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; database=<span style="color: #006080">'master'</span>,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; charset=<span style="color: #006080">"utf8"</span>);</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>sub_cursor = dest_db_conn.cursor(as_dict=True)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>sub_cursor.execute(<span style="color: #006080">"UPDATE TEST SET NAME='KKK' WHERE ID=100"</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000">#dest_db_conn.commit()</span></pre><!--CRLF--><pre><code><span style="color: #008000">#dest_db_conn.close()</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">dest_db_conn.close()</pre><!--CRLF--></div></div><br style="mso-special-character: line-break"></p></span><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"></span>
<p class="MsoNormal" style="background: white; word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 9pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">为了搞清楚上面这些问题，我修改了上面脚本，执行后，我去查询数据库, 发现即使上面的Python脚本没有提交事务，但是不会阻塞其它会话（其实是因为事务已经回滚了），对应的会话已经不存在了。猜测是因为Python脚本执行完成后，关闭了TCP层的连接而触发底层驱动关闭数据库连接（在关闭数据库连接之前，回滚了没有提交的事务）。</font></font></span></p>
<p class="MsoNormal" style="background: white; word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 9pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">那么怎么验证呢？ 很简单，我们使用休眠函数sleep，在关闭数据库联机（dest_db_conn.close()) 前让其休眠100秒，</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><br></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 14pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><br></span><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000"><font style="font-size: 11pt">dest_db_conn = pymssql.connect(</font></font></span><font style="font-size: 11pt"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#660099">host</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">=os.environ.get(</font></span><b><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#008080">'db_host'</font></span></b></font></font><font style="font-size: 11pt"><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">),<br><span style="line-height: 17pt; mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#660099">user</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">=</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000080">bytes</font></span></font><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">.decode(db_user),<br><span style="line-height: 17pt; mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#660099">password</font></span></font><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">=password_decrypted,<br><span style="line-height: 17pt; mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#660099">database</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">=</font></span><b><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#008080">'master'</font></span></b></font><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">,<br><span style="line-height: 17pt; mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#660099">charset</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">=</font></span><b><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#008080">"utf8"</font></span></b></font><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">);<br><br>sub_cursor = dest_db_conn.cursor(</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#660099">as_dict</font></span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">=</font></span><b><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000080">True</font></span></b></font><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000" face="Courier New">)<br><br><br></font></span><i><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><br></span></i><font face="Courier New"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000">sub_cursor.execute(</font></span><b><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#008080">"UPDATE TEST SET NAME='KKK' WHERE ID=100"</font></span></b></font><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000" face="Courier New">)<br></font></span><i><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><br></span></i><font face="Courier New"><font color="#ff0000"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体">time.sleep(</span><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体">100</span></font></font><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#000000" face="Courier New"><font color="#ff0000">)</font><br></font></span><i><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><br></span></i></font><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 11pt" color="#ff0000">dest_db_conn.close()</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 11pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"></font></font></span>&nbsp;</p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">然后在这期间，我们就可以查看会话信息、查看未提交的事务，构造阻塞会话等等。如下所示：</font></font><br style="mso-special-character: line-break"><br style="mso-special-character: line-break">
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #0000ff">SELECT</span> * <span style="color: #0000ff">FROM</span> sys.sysprocesses <span style="color: #0000ff">WHERE</span> loginame=<span style="color: #006080">'xxx'</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code><span style="color: #0000ff">DECLARE</span> @tab <span style="color: #0000ff">TABLE</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp; (</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAME <span style="color: #0000ff">VARCHAR</span>(100) ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">value</span>&nbsp;<span style="color: #0000ff">VARCHAR</span>(200)</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp; );</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">INSERT&nbsp; <span style="color: #0000ff">INTO</span> @tab</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">EXEC</span> ( <span style="color: #006080">'DBCC OPENTRAN WITH TABLERESULTS'</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</pre><!--CRLF--><pre><code><span style="color: #0000ff">SELECT</span>&nbsp; NAME ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">CAST</span>(<span style="color: #0000ff">value</span>&nbsp;<span style="color: #0000ff">AS</span> DATETIME) startDate ,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GETDATE() currentDate ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATEDIFF(s, <span style="color: #0000ff">CAST</span>(<span style="color: #0000ff">value</span>&nbsp;<span style="color: #0000ff">AS</span> DATETIME), GETDATE()) diffsecond</pre><!--CRLF--><pre><code><span style="color: #0000ff">FROM</span>&nbsp;&nbsp;&nbsp; @tab</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #0000ff">WHERE</span>&nbsp;&nbsp; NAME <span style="color: #0000ff">IN</span> ( <span style="color: #006080">'OLDACT_STARTTIME'</span> );</pre><!--CRLF--><pre><code><span style="color: #0000ff">SELECT</span>&nbsp; spid ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; blocked ,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DB_NAME(sp.dbid) <span style="color: #0000ff">AS</span> DBName ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; program_name ,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; waitresource ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastwaittype ,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sp.loginame ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sp.hostname ,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A.[text] <span style="color: #0000ff">AS</span> [TextData] ,</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">SUBSTRING</span>(A.text, sp.stmt_start / 2,</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( <span style="color: #0000ff">CASE</span>&nbsp;<span style="color: #0000ff">WHEN</span> sp.stmt_end = -1 <span style="color: #0000ff">THEN</span> DATALENGTH(A.text)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">ELSE</span> sp.stmt_end</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">END</span> - sp.stmt_start ) / 2) <span style="color: #0000ff">AS</span> [current_cmd]</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #0000ff">FROM</span>&nbsp;&nbsp;&nbsp; sys.sysprocesses <span style="color: #0000ff">AS</span> sp</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">OUTER</span> APPLY sys.dm_exec_sql_text(sp.sql_handle) <span style="color: #0000ff">AS</span> A</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #0000ff">WHERE</span>&nbsp;&nbsp; spid = ( <span style="color: #0000ff">SELECT</span>&nbsp;<span style="color: #0000ff">CASE</span>&nbsp;<span style="color: #0000ff">WHEN</span> ISNUMERIC(<span style="color: #0000ff">value</span>) = 0 <span style="color: #0000ff">THEN</span> -1</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">ELSE</span>&nbsp;<span style="color: #0000ff">value</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">END</span></pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">FROM</span>&nbsp;&nbsp; @tab</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">WHERE</span>&nbsp; NAME <span style="color: #0000ff">IN</span> ( <span style="color: #006080">'OLDACT_SPID'</span> )</pre><!--CRLF--><pre><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</pre><!--CRLF--></div></div></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font face="新宋体"><font style="font-size: 10pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font face="新宋体"><font style="font-size: 10pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: 15pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 新宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><a href="https://img2018.cnblogs.com/blog/73542/201908/73542-20190827161453889-1310490406.png"><img title="clip_image002" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image002" src="./images/pymssql的Connection相关特性浅析1.png" width="803" height="171"></a></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">那么为什么说是Python执行完成后，关闭TCP连接触发了底层驱动做这个事情呢？ 你测试时，发现执行完脚本后，都会有一个Audit Logout，如下截图所示，另外，你也可以将上面脚本的休眠函数和关闭数据库连接注释掉，你会发现，即使不关闭数据库连接，Python脚本执行完成后，事务也回滚了，数据库连接也关闭了。</font></font></span><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">其实如果你进行了上面测试，第三个问题已经基本不用回答了。显然已经不言而喻了</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-indent: 27pt; mso-layout-grid-align: none" align="left"><font face="Courier New"><font color="#ff0000"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font style="font-size: 11pt">#time.sleep(</font></span><font style="font-size: 11pt"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体">100</span></font></font></font><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Courier New"><font style="font-size: 11pt" color="#ff0000">)<br><span style="line-height: 17pt; mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>#dest_db_conn.close()</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-indent: 27pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font color="#ff0000" face="Courier New"></font></span>&nbsp;</p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; color: ; line-height: 17pt; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><a href="https://img2018.cnblogs.com/blog/73542/201908/73542-20190827161507883-1871583835.png"><img title="clip_image003" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="clip_image003" src="./images/pymssql的Connection相关特性浅析2.png" width="652" height="208"></a></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#ff0000"><strong>&nbsp;</strong></font></font></span></p>
<p><font color="#ff0000" face="Courier New"><strong>Audit Logout:Records all new disconnect events since the trace started, such as when a client issues a disconnect command</strong></font>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>