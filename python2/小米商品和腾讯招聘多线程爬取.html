<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修小米商品和腾讯招聘多线程爬取' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>小米商品和腾讯招聘多线程爬取</center></div><div class='banquan'>原文出处:本文由博客园博主Python及时行乐提供。<br/>
原文连接:https://www.cnblogs.com/ilovepython/p/11536545.html</div><br>
    <p><strong>该博文转载自：https://www.cnblogs.com/LXP-Never/p/11378709.html</strong></p>
<p>&nbsp;</p>
<p><strong>目录</strong></p>
<div><a href="https://www.cnblogs.com/LXP-Never/p/11378709.html#%E5%B0%8F%E7%B1%B3%E5%BA%94%E7%94%A8%E5%95%86%E5%BA%97%E6%8A%93%E5%8F%96%E5%A4%9A%E7%BA%BF%E7%A8%8B">&emsp;&emsp;小米应用商店抓取(多线程)</a><br /><a href="https://www.cnblogs.com/LXP-Never/p/11378709.html#%E8%85%BE%E8%AE%AF%E6%8B%9B%E8%81%98%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96ajax">&emsp;&emsp;腾讯招聘数据抓取(Ajax)</a></div>
<div>&nbsp;</div>
<div>
<p>应用场景</p>
<p>1、多进程 ：CPU密集程序<br />2、多线程 ：爬虫(网络I/O)、本地磁盘I/O</p>
<p>&nbsp;</p>
<h3>知识点回顾</h3>
<p>队列</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 导入模块</span>
<span style="color: #0000ff;">from</span> queue <span style="color: #0000ff;">import</span><span style="color: #000000;"> Queue
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 使用</span>
q =<span style="color: #000000;"> Queue()
q.put(url)
q.get() </span><span style="color: #008000;">#</span><span style="color: #008000;"> 当队列为空时，阻塞</span>
q.empty() <span style="color: #008000;">#</span><span style="color: #008000;"> 判断队列是否为空，True/False</span></pre>
</div>
<p>&nbsp;</p>
<p>线程模块</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">#</span><span style="color: #008000;"> 导入模块</span>
<span style="color: #0000ff;">from</span> threading <span style="color: #0000ff;">import</span><span style="color: #000000;"> Thread
​
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 使用流程  </span>
t = Thread(target=函数名) <span style="color: #008000;">#</span><span style="color: #008000;"> 创建线程对象</span>
t.start() <span style="color: #008000;">#</span><span style="color: #008000;"> 创建并启动线程</span>
t.join()  <span style="color: #008000;">#</span><span style="color: #008000;"> 阻塞等待回收线程</span></pre>
</div>
<p>&nbsp;</p>
<h2 id="blogTitle0">小米应用商店抓取(多线程)</h2>
<p><strong>目标</strong></p>
<ol>
<li>网址 ：百度搜 - 小米应用商店，进入官网，应用分类 - 聊天社交</li>
<li>目标 ：爬取应用名称和应用链接</li>
</ol>
<p><strong>实现步骤</strong></p>
<p>1、确认是否为动态加载</p>
<p>1、页面局部刷新</p>
<p>2、右键查看网页源代码，搜索关键字未搜到，因此此网站为动态加载网站，需要抓取网络数据包分析</p>
<p>2、F12抓取网络数据包</p>
<p>1、抓取返回json数据的URL地址（Headers中的Request URL）</p>
<p>&nbsp; http://app.mi.com/categotyAllListApi?page={}&amp;categoryId=2&amp;pageSize=30</p>
<p>2、查看并分析查询参数（headers中的Query String Parameters）只有page在变，0 1 2 3 ... ... ，这样我们就可以通过控制page的值拼接多个返回json数据的URL地址</p>
<p>&nbsp; page: 1</p>
<p>&nbsp; categoryId: 2</p>
<p>&nbsp; pageSize: 30</p>
<p>&nbsp;</p>
<p>3、将抓取数据保存到csv文件</p>
<p>注意多线程写入的线程锁问题</p>
<p>from threading import Lock</p>
<p>lock = Lock()</p>
<p>lock.acquire()</p>
<p>lock.release()</p>
<p>整体思路</p>
<ol>
<li>在 __init__(self) 中创建文件对象，多线程操作此对象进行文件写入</li>
<li>每个线程抓取数据后将数据进行文件写入，写入文件时需要加锁</li>
<li>所有数据抓取完成关闭文件</li>
</ol>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> requests
</span><span style="color: #0000ff;">from</span> threading <span style="color: #0000ff;">import</span><span style="color: #000000;"> Thread
</span><span style="color: #0000ff;">from</span> queue <span style="color: #0000ff;">import</span><span style="color: #000000;"> Queue
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> time
</span><span style="color: #0000ff;">from</span> lxml <span style="color: #0000ff;">import</span><span style="color: #000000;"> etree
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> csv
</span><span style="color: #0000ff;">from</span> threading <span style="color: #0000ff;">import</span><span style="color: #000000;"> Lock
</span><span style="color: #0000ff;">from</span> fake_useragent <span style="color: #0000ff;">import</span><span style="color: #000000;"> UserAgent


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> XiaomiSpider(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        self.url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">http://app.mi.com/categotyAllListApi?page={}&amp;categoryId={}&amp;pageSize=30</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.q </span>= Queue()  <span style="color: #008000;">#</span><span style="color: #008000;"> 存放所有URL地址的队列</span>
        self.i =<span style="color: #000000;"> 0
        self.id_list </span>= []  <span style="color: #008000;">#</span><span style="color: #008000;"> 存放所有类型id的空列表</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 打开文件</span>
        self.f = open(<span style="color: #800000;">'</span><span style="color: #800000;">xiaomi.csv</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">a</span><span style="color: #800000;">'</span>, newline=<span style="color: #800000;">""</span><span style="color: #000000;">)
        self.writer </span>=<span style="color: #000000;"> csv.writer(self.f)
        self.lock </span>= Lock()  <span style="color: #008000;">#</span><span style="color: #008000;"> 创建锁</span>
        self.ua =<span style="color: #000000;"> UserAgent()

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> get_cateid(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 请求</span>
        url = <span style="color: #800000;">'</span><span style="color: #800000;">http://app.mi.com/</span><span style="color: #800000;">'</span><span style="color: #000000;">
        headers </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">User-Agent</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.ua.random}
        html </span>= requests.get(url=url, headers=<span style="color: #000000;">headers).text
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 解析</span>
        parse_html =<span style="color: #000000;"> etree.HTML(html)
        li_list </span>= parse_html.xpath(<span style="color: #800000;">'</span><span style="color: #800000;">//ul[@class="category-list"]/li</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> li <span style="color: #0000ff;">in</span><span style="color: #000000;"> li_list:
            typ_name </span>= li.xpath(<span style="color: #800000;">'</span><span style="color: #800000;">./a/text()</span><span style="color: #800000;">'</span><span style="color: #000000;">)[0]
            typ_id </span>= li.xpath(<span style="color: #800000;">'</span><span style="color: #800000;">./a/@href</span><span style="color: #800000;">'</span>)[0].split(<span style="color: #800000;">'</span><span style="color: #800000;">/</span><span style="color: #800000;">'</span>)[-1<span style="color: #000000;">]
            pages </span>= self.get_pages(typ_id)  <span style="color: #008000;">#</span><span style="color: #008000;"> 计算每个类型的页数</span>
<span style="color: #000000;">            self.id_list.append((typ_id, pages))

        self.url_in()  </span><span style="color: #008000;">#</span><span style="color: #008000;"> 入队列</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 获取counts的值并计算页数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_pages(self, typ_id):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 每页返回的json数据中,都有count这个key</span>
        url =<span style="color: #000000;"> self.url.format(0, typ_id)
        html </span>= requests.get(url=url, headers={<span style="color: #800000;">'</span><span style="color: #800000;">User-Agent</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.ua.random}).json()
        count </span>= html[<span style="color: #800000;">'</span><span style="color: #800000;">count</span><span style="color: #800000;">'</span>]       <span style="color: #008000;">#</span><span style="color: #008000;"> 类别中的数据总数</span>
        pages = int(count) // 30 + 1        <span style="color: #008000;">#</span><span style="color: #008000;"> 每页30个，看有多少页</span>

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> pages

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> url入队列</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> url_in(self):
        </span><span style="color: #0000ff;">for</span> id <span style="color: #0000ff;">in</span><span style="color: #000000;"> self.id_list:
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> id为元组,(typ_id, pages)--&gt;('2',pages)</span>
            <span style="color: #0000ff;">for</span> page <span style="color: #0000ff;">in</span> range(2<span style="color: #000000;">):
                url </span>=<span style="color: #000000;"> self.url.format(page, id[0])
                </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(url)
                </span><span style="color: #008000;">#</span><span style="color: #008000;"> 把URL地址入队列</span>
<span style="color: #000000;">                self.q.put(url)

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 线程事件函数: get() - 请求 - 解析 - 处理数据</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_data(self):
        </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 当队列不为空时,获取url地址</span>
            <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> self.q.empty():
                url </span>=<span style="color: #000000;"> self.q.get()
                headers </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">User-Agent</span><span style="color: #800000;">'</span><span style="color: #000000;">: self.ua.random}
                html </span>= requests.get(url=url, headers=<span style="color: #000000;">headers).json()
                self.parse_html(html)
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
                </span><span style="color: #0000ff;">break</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 解析函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_html(self, html):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 存放1页的数据 - 写入到csv文件</span>
        app_list =<span style="color: #000000;"> []
        </span><span style="color: #0000ff;">for</span> app <span style="color: #0000ff;">in</span> html[<span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span><span style="color: #000000;">]:
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 应用名称 + 链接 + 分类</span>
            name = app[<span style="color: #800000;">'</span><span style="color: #800000;">displayName</span><span style="color: #800000;">'</span><span style="color: #000000;">]
            link </span>= <span style="color: #800000;">'</span><span style="color: #800000;">http://app.mi.com/details?id=</span><span style="color: #800000;">'</span> + app[<span style="color: #800000;">'</span><span style="color: #800000;">packageName</span><span style="color: #800000;">'</span><span style="color: #000000;">]
            typ_name </span>= app[<span style="color: #800000;">'</span><span style="color: #800000;">level1CategoryName</span><span style="color: #800000;">'</span><span style="color: #000000;">]
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 把每一条数据放到app_list中,目的为了 writerows()</span>
<span style="color: #000000;">            app_list.append([name, typ_name, link])
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(name, typ_name)
            self.i </span>+= 1

        <span style="color: #008000;">#</span><span style="color: #008000;"> 开始写入1页数据 - app_list</span>
<span style="color: #000000;">        self.lock.acquire()
        self.writer.writerows(app_list)
        self.lock.release()

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 主函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> main(self):
        self.get_cateid()       </span><span style="color: #008000;">#</span><span style="color: #008000;"> URL入队列</span>
        t_list =<span style="color: #000000;"> []
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 创建多个线程</span>
        <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(1<span style="color: #000000;">):
            t </span>= Thread(target=<span style="color: #000000;">self.get_data)
            t_list.append(t)
            t.start()

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 统一回收线程</span>
        <span style="color: #0000ff;">for</span> t <span style="color: #0000ff;">in</span><span style="color: #000000;"> t_list:
            t.join()

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 关闭文件</span>
<span style="color: #000000;">        self.f.close()
        </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">数量:</span><span style="color: #800000;">'</span><span style="color: #000000;">, self.i)


</span><span style="color: #0000ff;">if</span> <span style="color: #800080;">__name__</span> == <span style="color: #800000;">'</span><span style="color: #800000;">__main__</span><span style="color: #800000;">'</span><span style="color: #000000;">:
    start </span>=<span style="color: #000000;"> time.time()
    spider </span>=<span style="color: #000000;"> XiaomiSpider()
    spider.main()
    end </span>=<span style="color: #000000;"> time.time()
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">执行时间:%.2f</span><span style="color: #800000;">'</span> % (end - start))</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id="blogTitle1">腾讯招聘数据抓取(Ajax)</h2>
<p><strong>确定URL地址及目标</strong></p>
<ul>
<li>URL: 百度搜索腾讯招聘 - 查看工作岗位<a href="https://careers.tencent.com/search.html">https://careers.tencent.com/search.html</a></li>
<li>目标: 职位名称、工作职责、岗位要求</li>
</ul>
<p><strong>要求与分析</strong></p>
<ol>
<li>通过查看网页源码，得知所需数据均为 Ajax 动态加载</li>
<li>通过F12抓取网络数据包，进行分析</li>
<li>一级页面抓取数据: 职位名称</li>
<li>二级页面抓取数据: 工作职责、岗位要求</li>
</ol>
<p>一级页面json地址(pageIndex在变,timestamp未检查)</p>
<p>https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1563912271089&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex={}&amp;pageSize=10&amp;language=zh-cn&amp;area=cn</p>
<p>二级页面地址(postId在变,在一级页面中可拿到)</p>
<p>https://careers.tencent.com/tencentcareer/api/post/ByPostId?timestamp=1563912374645&amp;postId={}&amp;language=zh-cn</p>
<p>useragents.py文件</p>
<div class="cnblogs_code">
<pre><code>ua_list =<span style="color: #000000;"> [
  </span><span style="color: #800000;">'</span><span style="color: #800000;">Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.163 Safari/535.1</span><span style="color: #800000;">'</span><span style="color: #000000;">,
  </span><span style="color: #800000;">'</span><span style="color: #800000;">Mozilla/5.0 (Windows NT 6.1; WOW64; rv:6.0) Gecko/20100101 Firefox/6.0</span><span style="color: #800000;">'</span><span style="color: #000000;">,
  </span><span style="color: #800000;">'</span><span style="color: #800000;">Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; InfoPath.3)</span><span style="color: #800000;">'</span><span style="color: #000000;">,
]</span></pre>
</div>
<p>&nbsp;</p>
<p>我们先来回忆一下原来的腾讯招聘爬虫代码</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> time
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> json
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> random
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> requests
</span><span style="color: #0000ff;">from</span> useragents <span style="color: #0000ff;">import</span><span style="color: #000000;"> ua_list


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> TencentSpider(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        self.one_url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1563912271089&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex={}&amp;pageSize=10&amp;language=zh-cn&amp;area=cn</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.two_url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://careers.tencent.com/tencentcareer/api/post/ByPostId?timestamp=1563912374645&amp;postId={}&amp;language=zh-cn</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.f </span>= open(<span style="color: #800000;">'</span><span style="color: #800000;">tencent.json</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">a</span><span style="color: #800000;">'</span>)  <span style="color: #008000;">#</span><span style="color: #008000;"> 打开文件</span>
        self.item_list = []  <span style="color: #008000;">#</span><span style="color: #008000;"> 存放抓取的item字典数据</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 获取响应内容函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_page(self, url):
        headers </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">User-Agent</span><span style="color: #800000;">'</span><span style="color: #000000;">: random.choice(ua_list)}
        html </span>= requests.get(url=url, headers=<span style="color: #000000;">headers).text
        html </span>= json.loads(html)  <span style="color: #008000;">#</span><span style="color: #008000;"> json格式字符串转为Python数据类型</span>

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> html

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 主线函数: 获取所有数据</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_page(self, one_url):
        html </span>=<span style="color: #000000;"> self.get_page(one_url)
        item </span>=<span style="color: #000000;"> {}
        </span><span style="color: #0000ff;">for</span> job <span style="color: #0000ff;">in</span> html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Posts</span><span style="color: #800000;">'</span><span style="color: #000000;">]:
            item[</span><span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>] = job[<span style="color: #800000;">'</span><span style="color: #800000;">RecruitPostName</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 名称</span>
            post_id = job[<span style="color: #800000;">'</span><span style="color: #800000;">PostId</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> postId，拿postid为了拼接二级页面地址</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 拼接二级地址,获取职责和要求</span>
            two_url =<span style="color: #000000;"> self.two_url.format(post_id)
            item[</span><span style="color: #800000;">'</span><span style="color: #800000;">duty</span><span style="color: #800000;">'</span>], item[<span style="color: #800000;">'</span><span style="color: #800000;">require</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> self.parse_two_page(two_url)
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(item)
            self.item_list.append(item)  </span><span style="color: #008000;">#</span><span style="color: #008000;"> 添加到大列表中</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 解析二级页面函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_two_page(self, two_url):
        html </span>=<span style="color: #000000;"> self.get_page(two_url)
        duty </span>= html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Responsibility</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 工作责任</span>
        duty = duty.replace(<span style="color: #800000;">'</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>)  <span style="color: #008000;">#</span><span style="color: #008000;"> 去掉换行</span>
        require = html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Requirement</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 工作要求</span>
        require = require.replace(<span style="color: #800000;">'</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>)  <span style="color: #008000;">#</span><span style="color: #008000;"> 去掉换行</span>

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> duty, require

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取总页数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_numbers(self):
        url </span>= self.one_url.format(1<span style="color: #000000;">)
        html </span>=<span style="color: #000000;"> self.get_page(url)
        numbers </span>= int(html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Count</span><span style="color: #800000;">'</span>]) // 10 + 1  <span style="color: #008000;">#</span><span style="color: #008000;"> 每页有10个推荐</span>

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> numbers

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> main(self):
        number </span>=<span style="color: #000000;"> self.get_numbers()
        </span><span style="color: #0000ff;">for</span> page <span style="color: #0000ff;">in</span> range(1, 3<span style="color: #000000;">):
            one_url </span>=<span style="color: #000000;"> self.one_url.format(page)
            self.parse_page(one_url)

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 保存到本地json文件:json.dump</span>
        json.dump(self.item_list, self.f, ensure_ascii=<span style="color: #000000;">False)
        self.f.close()


</span><span style="color: #0000ff;">if</span> <span style="color: #800080;">__name__</span> == <span style="color: #800000;">'</span><span style="color: #800000;">__main__</span><span style="color: #800000;">'</span><span style="color: #000000;">:
    start </span>=<span style="color: #000000;"> time.time()
    spider </span>=<span style="color: #000000;"> TencentSpider()
    spider.main()
    end </span>=<span style="color: #000000;"> time.time()
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">执行时间:%.2f</span><span style="color: #800000;">'</span> % (end - start))</pre>
</div>
<p>&nbsp;</p>
<h3>多线程实现</h3>
<p>多线程即把所有一级页面链接提交到队列,进行多线程数据抓取</p>
<p>代码实现</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> requests
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> json
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> time
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> random
</span><span style="color: #0000ff;">from</span> useragents <span style="color: #0000ff;">import</span><span style="color: #000000;"> ua_list
</span><span style="color: #0000ff;">from</span> threading <span style="color: #0000ff;">import</span><span style="color: #000000;"> Thread
</span><span style="color: #0000ff;">from</span> queue <span style="color: #0000ff;">import</span><span style="color: #000000;"> Queue


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> TencentSpider(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        self.one_url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1563912271089&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex={}&amp;pageSize=10&amp;language=zh-cn&amp;area=cn</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.two_url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://careers.tencent.com/tencentcareer/api/post/ByPostId?timestamp=1563912374645&amp;postId={}&amp;language=zh-cn</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.q </span>=<span style="color: #000000;"> Queue()
        self.i </span>= 0  <span style="color: #008000;">#</span><span style="color: #008000;"> 计数</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 获取响应内容函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_page(self, url):
        headers </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">User-Agent</span><span style="color: #800000;">'</span><span style="color: #000000;">: random.choice(ua_list)}
        html </span>= requests.get(url=url, headers=<span style="color: #000000;">headers).text
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> json.loads()把json格式的字符串转为python数据类型</span>
        html =<span style="color: #000000;"> json.loads(html)

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> html

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 主线函数: 获取所有数据</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_page(self):
        </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
            </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> self.q.empty():
                one_url </span>=<span style="color: #000000;"> self.q.get()
                html </span>=<span style="color: #000000;"> self.get_page(one_url)
                item </span>=<span style="color: #000000;"> {}
                </span><span style="color: #0000ff;">for</span> job <span style="color: #0000ff;">in</span> html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Posts</span><span style="color: #800000;">'</span><span style="color: #000000;">]:
                    item[</span><span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>] = job[<span style="color: #800000;">'</span><span style="color: #800000;">RecruitPostName</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 名称</span>
                    post_id = job[<span style="color: #800000;">'</span><span style="color: #800000;">PostId</span><span style="color: #800000;">'</span>]  <span style="color: #008000;">#</span><span style="color: #008000;"> 拿postid为了拼接二级页面地址</span>
                    <span style="color: #008000;">#</span><span style="color: #008000;"> 拼接二级地址,获取职责和要求</span>
                    two_url =<span style="color: #000000;"> self.two_url.format(post_id)
                    item[</span><span style="color: #800000;">'</span><span style="color: #800000;">duty</span><span style="color: #800000;">'</span>], item[<span style="color: #800000;">'</span><span style="color: #800000;">require</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> self.parse_two_page(two_url)
                    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(item)
                </span><span style="color: #008000;">#</span><span style="color: #008000;"> 每爬取按完成1页随机休眠</span>
                time.sleep(random.uniform(0, 1<span style="color: #000000;">))
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
                </span><span style="color: #0000ff;">break</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 解析二级页面函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_two_page(self, two_url):
        html </span>=<span style="color: #000000;"> self.get_page(two_url)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 用replace处理一下特殊字符</span>
        duty = html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Responsibility</span><span style="color: #800000;">'</span><span style="color: #000000;">]
        duty </span>= duty.replace(<span style="color: #800000;">'</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span><span style="color: #000000;">)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 处理要求</span>
        require = html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Requirement</span><span style="color: #800000;">'</span><span style="color: #000000;">]
        require </span>= require.replace(<span style="color: #800000;">'</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span><span style="color: #000000;">)

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> duty, require

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取总页数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_numbers(self):
        url </span>= self.one_url.format(1<span style="color: #000000;">)
        html </span>=<span style="color: #000000;"> self.get_page(url)
        numbers </span>= int(html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Count</span><span style="color: #800000;">'</span>]) // 10 + 1

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> numbers

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> main(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> one_url入队列</span>
        number =<span style="color: #000000;"> self.get_numbers()
        </span><span style="color: #0000ff;">for</span> page <span style="color: #0000ff;">in</span> range(1, number + 1<span style="color: #000000;">):
            one_url </span>=<span style="color: #000000;"> self.one_url.format(page)
            self.q.put(one_url)

        t_list </span>=<span style="color: #000000;"> []
        </span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(5<span style="color: #000000;">):
            t </span>= Thread(target=<span style="color: #000000;">self.parse_page)
            t_list.append(t)
            t.start()

        </span><span style="color: #0000ff;">for</span> t <span style="color: #0000ff;">in</span><span style="color: #000000;"> t_list:
            t.join()

        </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">数量:</span><span style="color: #800000;">'</span><span style="color: #000000;">, self.i)


</span><span style="color: #0000ff;">if</span> <span style="color: #800080;">__name__</span> == <span style="color: #800000;">'</span><span style="color: #800000;">__main__</span><span style="color: #800000;">'</span><span style="color: #000000;">:
    start </span>=<span style="color: #000000;"> time.time()
    spider </span>=<span style="color: #000000;"> TencentSpider()
    spider.main()
    end </span>=<span style="color: #000000;"> time.time()
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">执行时间:%.2f</span><span style="color: #800000;">'</span> % (end - start))</pre>
</div>
<p>&nbsp;</p>
<h3>多进程实现</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> requests
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> json
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> time
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> random
</span><span style="color: #0000ff;">from</span> useragents <span style="color: #0000ff;">import</span><span style="color: #000000;"> ua_list
</span><span style="color: #0000ff;">from</span> multiprocessing <span style="color: #0000ff;">import</span><span style="color: #000000;"> Process
</span><span style="color: #0000ff;">from</span> queue <span style="color: #0000ff;">import</span><span style="color: #000000;"> Queue


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> TencentSpider(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        self.one_url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1563912271089&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=&amp;pageIndex={}&amp;pageSize=10&amp;language=zh-cn&amp;area=cn</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.two_url </span>= <span style="color: #800000;">'</span><span style="color: #800000;">https://careers.tencent.com/tencentcareer/api/post/ByPostId?timestamp=1563912374645&amp;postId={}&amp;language=zh-cn</span><span style="color: #800000;">'</span><span style="color: #000000;">
        self.q </span>=<span style="color: #000000;"> Queue()

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取响应内容函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_page(self, url):
        headers </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">User-Agent</span><span style="color: #800000;">'</span><span style="color: #000000;">: random.choice(ua_list)}
        html </span>= requests.get(url=url, headers=<span style="color: #000000;">headers).text
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> json格式字符串 -&gt; Python</span>
        html =<span style="color: #000000;"> json.loads(html)

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> html

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 主线函数: 获取所有数据</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_page(self):
        </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
            </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> self.q.empty():
                one_url </span>=<span style="color: #000000;"> self.q.get()
                html </span>=<span style="color: #000000;"> self.get_page(one_url)
                item </span>=<span style="color: #000000;"> {}
                </span><span style="color: #0000ff;">for</span> job <span style="color: #0000ff;">in</span> html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Posts</span><span style="color: #800000;">'</span><span style="color: #000000;">]:
                    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 名称</span>
                    item[<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>] = job[<span style="color: #800000;">'</span><span style="color: #800000;">RecruitPostName</span><span style="color: #800000;">'</span><span style="color: #000000;">]
                    </span><span style="color: #008000;">#</span><span style="color: #008000;"> postId</span>
                    post_id = job[<span style="color: #800000;">'</span><span style="color: #800000;">PostId</span><span style="color: #800000;">'</span><span style="color: #000000;">]
                    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 拼接二级地址,获取职责和要求</span>
                    two_url =<span style="color: #000000;"> self.two_url.format(post_id)
                    item[</span><span style="color: #800000;">'</span><span style="color: #800000;">duty</span><span style="color: #800000;">'</span>], item[<span style="color: #800000;">'</span><span style="color: #800000;">require</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> self.parse_two_page(two_url)

                    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(item)
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
                </span><span style="color: #0000ff;">break</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 解析二级页面函数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> parse_two_page(self, two_url):
        html </span>=<span style="color: #000000;"> self.get_page(two_url)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 用replace处理一下特殊字符</span>
        duty = html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Responsibility</span><span style="color: #800000;">'</span><span style="color: #000000;">]
        duty </span>= duty.replace(<span style="color: #800000;">'</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span><span style="color: #000000;">)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 处理要求</span>
        require = html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Requirement</span><span style="color: #800000;">'</span><span style="color: #000000;">]
        require </span>= require.replace(<span style="color: #800000;">'</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span>, <span style="color: #800000;">''</span><span style="color: #000000;">)

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> duty, require

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取总页数</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> get_numbers(self):
        url </span>= self.one_url.format(1<span style="color: #000000;">)
        html </span>=<span style="color: #000000;"> self.get_page(url)
        numbers </span>= int(html[<span style="color: #800000;">'</span><span style="color: #800000;">Data</span><span style="color: #800000;">'</span>][<span style="color: #800000;">'</span><span style="color: #800000;">Count</span><span style="color: #800000;">'</span>]) // 10 + 1

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> numbers

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> main(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> url入队列</span>
        number =<span style="color: #000000;"> self.get_numbers()
        </span><span style="color: #0000ff;">for</span> page <span style="color: #0000ff;">in</span> range(1, number + 1<span style="color: #000000;">):
            one_url </span>=<span style="color: #000000;"> self.one_url.format(page)
            self.q.put(one_url)

        t_list </span>=<span style="color: #000000;"> []
        </span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(4<span style="color: #000000;">):
            t </span>= Process(target=<span style="color: #000000;">self.parse_page)
            t_list.append(t)
            t.start()

        </span><span style="color: #0000ff;">for</span> t <span style="color: #0000ff;">in</span><span style="color: #000000;"> t_list:
            t.join()


</span><span style="color: #0000ff;">if</span> <span style="color: #800080;">__name__</span> == <span style="color: #800000;">'</span><span style="color: #800000;">__main__</span><span style="color: #800000;">'</span><span style="color: #000000;">:
    start </span>=<span style="color: #000000;"> time.time()
    spider </span>=<span style="color: #000000;"> TencentSpider()
    spider.main()
    end </span>=<span style="color: #000000;"> time.time()
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">执行时间:%.2f</span><span style="color: #800000;">'</span> % (end - start))</pre>
</div>
<p>&nbsp;</p>
<p>　</p>
</div>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>