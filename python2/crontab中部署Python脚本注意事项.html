<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修crontab中部署Python脚本注意事项' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>crontab中部署Python脚本注意事项</center></div><div class='banquan'>原文出处:本文由博客园博主潇湘隐者提供。<br/>
原文连接:https://www.cnblogs.com/kerrycode/p/11386074.html</div><br>
    <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">有时候手工执行Python脚本跑的好好的，但是部署到Linux的crontab中后，就会遇到一些问题，最近终于有空整理一下这方面的内容，其实也是自己也踩了一些别人踩过的坑！这里仅仅列举个人遇到的一些小问题，经验和精力问题，不能面面俱到，仅总结一下自己遇到的这些问题。</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">环境变量问题</font></font></span></b></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">&nbsp;</font></font></span></b></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">cron中的环境变量和系统的环境变量是不一样的，我们可以通过设置定时脚本将cron中的环境变量打印出来,然后一对比，你就能发现差异</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><font face="Times New Roman"><font style="font-size: 12pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><font color="#000000"><span lang="X-NONE" style="font-family: ; line-height: normal; mso-font-kerning: 0pt; mso-ansi-language: x-none; mso-fareast-font-family: 宋体"><span style="line-height: normal; mso-spacerun: yes"><font face="Times New Roman"><font style="font-size: 12pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></font></span></span><span style="font-family: ; line-height: normal; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt">* * * * * env &gt; /tmp/env.txt</font></font></span></font></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: normal; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: normal; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">如果你Python脚本中要获取环境变量的话，那么部署到Crontab作业后就要小心了，很有可能手工运行脚本是正常的，但是部署到Crontab后运行就不正常了，如下所示，我们构造这样一个测试脚本crontab_env_test.py</font></font></span></p> <p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p> <div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4"> <div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000">#!/usr/bin/python</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># -*- coding: utf-8 -*-</span></pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import logging</pre><!--CRLF--><pre><code>import os.path</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import os</pre><!--CRLF--><pre><code>import base64</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code><span style="color: #008000"># 第一步，创建一个logger</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">logger = logging.getLogger()</pre><!--CRLF--><pre><code>logger.setLevel(logging.DEBUG)&nbsp; <span style="color: #008000"># Log等级开关</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># 第二步，创建一个handler，用于写入日志文件</span></pre><!--CRLF--><pre><code>log_path = <span style="color: #006080">'/home/konglb/logs/'</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">log_name = log_path + <span style="color: #006080">'kerry_test.log'</span></pre><!--CRLF--><pre><code>logfile = log_name</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">file_handler = logging.FileHandler(logfile, mode=<span style="color: #006080">'a+'</span>)</pre><!--CRLF--><pre><code>file_handler.setLevel(logging.ERROR)&nbsp; <span style="color: #008000"># 输出到file的log等级的开关</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># 第三步，定义handler的输出格式</span></pre><!--CRLF--><pre><code>formatter = logging.Formatter(<span style="color: #006080">"%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s"</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">file_handler.setFormatter(formatter)</pre><!--CRLF--><pre><code><span style="color: #008000"># 第四步，将handler添加到logger里面</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">logger.addHandler(file_handler)</pre><!--CRLF--><pre><code><span style="color: #008000"># 如果需要同時需要在終端上輸出，定義一個streamHandler</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">print_handler = logging.StreamHandler()&nbsp; <span style="color: #008000"># 往屏幕上输出</span></pre><!--CRLF--><pre><code>print_handler.setFormatter(formatter)&nbsp; <span style="color: #008000"># 设置屏幕上显示的格式</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">logger.addHandler(print_handler)</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>db_user=os.environ.get(<span style="color: #006080">'my_env'</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">print(db_user)</pre><!--CRLF--><pre><code>logger.error(db_user)</pre><!--CRLF--></div></div>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">如下所示，手工执行该脚本，就会往/home/konglb/logs/kerry_test.log中写入环境变量my_env的值（/etc/profile中设置了export my_env=kerry ）</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"># /usr/local/bin/python3.6 /home/konglb/python/crontab_env_test.py</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">kerry</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">2019-08-20 20:20:18,293 - crontab_env_test.py[line:30] - ERROR: kerry</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">然后我们配置crontab后，如下所示，通过刷新日志观察其获取环境变量my_env的值</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"># crontab -l</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">*/1 * * * *<span style="line-height: 16pt; mso-spacerun: yes">&nbsp; </span>/usr/local/bin/python3.6 /home/konglb/python/crontab_env_test.py </font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">如下截图所示，你会看到在Crontab中运行的Python脚本根本没有获取到环境变量my_env的值</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000"># tail -60f kerry_test.log </span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:20:18,293 - crontab_env_test.py[line:30] - ERROR: kerry</pre><!--CRLF--><pre><code>2019-08-20 20:22:02,337 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:23:01,533 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre><code>2019-08-20 20:24:01,682 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:25:01,832 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre><code>2019-08-20 20:26:01,103 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:27:01,243 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre><code>2019-08-20 20:28:01,397 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:29:01,543 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre><code>2019-08-20 20:30:01,680 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:31:01,998 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre><code>2019-08-20 20:32:01,223 - crontab_env_test.py[line:30] - ERROR: None</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">2019-08-20 20:33:01,369 - crontab_env_test.py[line:30] - ERROR: Non</pre><!--CRLF--></div></div>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">那么要如何解决这个问题呢，如下所示，在执行Python脚本时，获取/etc/profile中的系统变量（不同平台或不同环境有所区别）</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">*/1 * * * * source /etc/profile &amp;&amp; /usr/local/bin/python3.6 /home/konglb/python/crontab_env_test.py</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><a href="https://img2018.cnblogs.com/blog/73542/201908/73542-20190820222745510-2140652605.png"><img title="clip_image001" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="clip_image001" src="./images/crontab中部署Python脚本注意事项0.png" width="650" height="225"></a></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">还有一种方案，就是使用shell包裹Python脚本，如下所示：</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000"># more kerry.sh </span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code><span style="color: #008000">#!/bin/bash</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>source /etc/profile</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>/usr/<span style="color: #0000ff">local</span>/bin/python3.6 /home/konglb/python/crontab_env_test.py</pre><!--CRLF--></div></div>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">*/1 * * * *<span style="line-height: 16pt; mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>/home/konglb/python/kerry.sh </font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">&nbsp;</font></font></span></b></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">相对路径问题</font></font></span></b></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">&nbsp;</font></font></span></b></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">把上面的脚本修改一下，使用相对路径，如下所示，然后crontab作业运行时就会报错</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000">#!/usr/bin/python</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># -*- coding: utf-8 -*-</span></pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import logging</pre><!--CRLF--><pre><code>import os.path</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">import os</pre><!--CRLF--><pre><code>import base64</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code><span style="color: #008000"># 第一步，创建一个logger</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">logger = logging.getLogger()</pre><!--CRLF--><pre><code>logger.setLevel(logging.DEBUG)&nbsp; <span style="color: #008000"># Log等级开关</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># 第二步，创建一个handler，用于写入日志文件</span></pre><!--CRLF--><pre><code><span style="color: #008000">#log_path = '/home/konglb/logs/'</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">log_path = os.path.dirname(os.getcwd()) + <span style="color: #006080">'/logs/'</span></pre><!--CRLF--><pre><code>log_name = log_path + <span style="color: #006080">'kerry_test.log'</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">logfile = log_name</pre><!--CRLF--><pre><code>file_handler = logging.FileHandler(logfile, mode=<span style="color: #006080">'a+'</span>)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">file_handler.setLevel(logging.ERROR)&nbsp; <span style="color: #008000"># 输出到file的log等级的开关</span></pre><!--CRLF--><pre><code><span style="color: #008000"># 第三步，定义handler的输出格式</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">formatter = logging.Formatter(<span style="color: #006080">"%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s"</span>)</pre><!--CRLF--><pre><code>file_handler.setFormatter(formatter)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># 第四步，将handler添加到logger里面</span></pre><!--CRLF--><pre><code>logger.addHandler(file_handler)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><span style="color: #008000"># 如果需要同時需要在終端上輸出，定義一個streamHandler</span></pre><!--CRLF--><pre><code>print_handler = logging.StreamHandler()&nbsp; <span style="color: #008000"># 往屏幕上输出</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">print_handler.setFormatter(formatter)&nbsp; <span style="color: #008000"># 设置屏幕上显示的格式</span></pre><!--CRLF--><pre><code>logger.addHandler(print_handler)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;</pre><!--CRLF--><pre><code>&nbsp;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">db_user=os.environ.get(<span style="color: #006080">'my_env'</span>)</pre><!--CRLF--><pre><code><span style="color: #0000ff">print</span>(db_user)</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">logger.error(db_user)</pre><!--CRLF--></div></div>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">其实切换到其它路径后，手工执行该脚本也会报错误，因为相对路径的设置，导致一些逻辑错误出现，如下所示，所以如果要部署为Crontab作业的Python脚本，最好使用绝对路径，避免出现这个问题。</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<div id="codeSnippetWrapper" style="overflow: auto; cursor: text; font-size: 11pt; border-top: silver 1px solid; font-family: 'Courier New', courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 11pt; padding-right: 4px; max-height: 1200px; background-color: #f4f4f4">
<div id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4"><pre><code><span style="color: #008000"># pwd</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">/root</pre><!--CRLF--><pre><code><span style="color: #008000"># /usr/local/bin/python3.6 /home/konglb/python/crontab_env_test.py</span></pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">Traceback (most recent call last):</pre><!--CRLF--><pre><code>&nbsp; File <span style="color: #006080">"/home/konglb/python/crontab_env_test.py"</span>, line 19, <span style="color: #0000ff">in</span> &lt;module&gt;</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp; file_handler = logging.FileHandler(logfile, mode=<span style="color: #006080">'a+'</span>)</pre><!--CRLF--><pre><code>&nbsp; File <span style="color: #006080">"/usr/local/lib/python3.6/logging/__init__.py"</span>, line 1031, <span style="color: #0000ff">in</span> __init__</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp; StreamHandler.__init__(self, self._open())</pre><!--CRLF--><pre><code>&nbsp; File <span style="color: #006080">"/usr/local/lib/python3.6/logging/__init__.py"</span>, line 1060, <span style="color: #0000ff">in</span> _open</pre><!--CRLF--><pre style="border-top-style: none; overflow: visible; font-size: 11pt; font-family: 'Courier New', courier, monospace; width: 100%; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; border-left-style: none; line-height: 11pt; padding-right: 0px; background-color: #f4f4f4">&nbsp;&nbsp;&nbsp; <span style="color: #0000ff">return</span> open(self.baseFilename, self.mode, encoding=self.encoding)</pre><!--CRLF--><pre><code>FileNotFoundError: [Errno 2] No such file or directory: <span style="color: #006080">'//logs/kerry_test.log'</span></pre><!--CRLF--></div></div>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000"></font></font></span>&nbsp;</p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">另外，像密码过期导致crontab不执行作业（<a href="https://www.cnblogs.com/kerrycode/archive/2016/01/19/5143774.html" target="_blank">Linux账号密码过期会导致crontab作业不能执行</a>）这样的案例也遇到过，不过这个与Python脚本无关系，如果遇到相关问题，可以从<a href="https://github.com/tony-yin/Why-Cronjob-Not-Work" target="_blank">Why-Cronjob-Not-Work</a>这篇文章介绍的这几个方面去思考、分析判断。</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">&nbsp;</font></font></span></b></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 18pt" color="#000000">&nbsp;</font></font></span></b></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><font face="宋体"><font color="#000000"><b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font style="font-size: 18pt">参考资料</font></span></b><span style="font-family: ; line-height: 27pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: x-none"><font style="font-size: 18pt">：</font><span lang="X-NONE" style="line-height: 27pt"></span></span></font></font></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 0pt; mso-layout-grid-align: none" align="left"><span style="font-family: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#000000">&nbsp;</font></font></span></p>
<p class="MsoNormal" style="word-break: normal; margin: 0cm 0cm 0pt; line-height: 16pt; text-autospace: ; text-indent: 21pt; mso-layout-grid-align: none" align="left">&nbsp;<u><span style="font-family: ; color: ; line-height: 16pt; mso-bidi-font-size: 10.5pt; mso-hansi-font-family: 等线; mso-hansi-theme-font: minor-latin; mso-bidi-font-family: 宋体; mso-font-kerning: 0pt; mso-ansi-language: zh-cn"><font face="宋体"><font style="font-size: 10.5pt" color="#0000ff">https://www.tony-yin.site/2018/10/29/Why-Crontab-Not-Work/</font></font></span></u></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>