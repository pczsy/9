<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修国庆手撸商品管理系统(三)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>国庆手撸商品管理系统(三)</center></div><div class='banquan'>原文出处:本文由博客园博主小小咸鱼YwY提供。<br/>
原文连接:https://www.cnblogs.com/pythonywy/p/11625930.html</div><br>
    <p><code>之前的内容</code></p>
<p><a href="https://www.cnblogs.com/pythonywy/p/11483157.html#4349683">点我管理系统(一)</a></p>
<p><a href="https://www.cnblogs.com/pythonywy/p/11620005.html">点我管理系统(二)</a></p>
<h2 id="一.实现的内容">一.实现的内容</h2>
<ul>
<li><p>商品退货</p></li>
<li><p>商品库存</p></li>
<li><p>商品进货</p></li>
<li><p>商品删除</p></li>
<li><p>商品还原</p></li>
<li><p>时钟</p></li>
<li><p>优化模型</p></li>
</ul>
<h2 id="二.后续内容准备优化内容">二.后续内容准备优化内容</h2>
<ul>
<li>把数据库查询的内容存在缓存中</li>
<li>增加按日期,按商品名查询</li>
<li>增加快捷商品增加</li>
<li>优化代码</li>
<li>优化界面</li>
</ul>
<h2 id="三.目录结构">三.目录结构</h2>
<pre><code><code>drf_test
|___drf_api
|    |___admin.py
|    |___apps.py
|    |___migrations
|    |___models.py
|    |___tests.py
|    |___userinfo_form.py
|    |___views
|    |    |____commodity.py
|    |    |____user.py
|    |_____init__.py
|___drf_test
|    |___settings.py
|    |___urls.py
|    |___wsgi.py
|    |_____init__.py
|___img
|    |___avatar
|___manage.py
|___static
|    |___bootstrap-3.3.7-dist
|    |___jquery-3.4.1.min.js
|___templates
|    |___aa.html
|    |___add.html
|    |___del.html
|    |___index.html
|    |___login.html
|    |___register.html
|    |___return.html
|    |___sales.html
|    |___show.html
|    |___show_del.html
|    |___template.html
|_____pycache__
|    |___manage.cpython-37.pyc</code></pre>
<h2 id="四.代码">四.代码</h2>
<h3 id="配置">1.配置</h3>
<p>setting.py</p>
<pre><code><code>&quot;&quot;&quot;
Django settings for drf_test project.

Generated by &#39;django-admin startproject&#39; using Django 1.11.22.

For more information on this file, see
https://docs.djangoproject.com/en/1.11/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.11/ref/settings/
&quot;&quot;&quot;

import os
# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = &#39;ppa5l3jvxr4k^ow*4o+0_^7@&amp;sa3x+!hb_$artwraa%60iq@g7&#39;

# SECURITY WARNING: don&#39;t run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    &#39;django.contrib.admin&#39;,
    &#39;django.contrib.auth&#39;,
    &#39;django.contrib.contenttypes&#39;,
    &#39;django.contrib.sessions&#39;,
    &#39;django.contrib.messages&#39;,
    &#39;django.contrib.staticfiles&#39;,
    &#39;drf_api&#39;,
    &#39;rest_framework&#39;,
]

MIDDLEWARE = [
    &#39;django.middleware.security.SecurityMiddleware&#39;,
    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
    &#39;django.middleware.common.CommonMiddleware&#39;,
    &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
]

ROOT_URLCONF = &#39;drf_test.urls&#39;

TEMPLATES = [
    {
        &#39;BACKEND&#39;: &#39;django.template.backends.django.DjangoTemplates&#39;,
        &#39;DIRS&#39;: [os.path.join(BASE_DIR, &#39;templates&#39;)]
        ,
        &#39;APP_DIRS&#39;: True,
        &#39;OPTIONS&#39;: {
            &#39;context_processors&#39;: [
                &#39;django.template.context_processors.debug&#39;,
                &#39;django.template.context_processors.request&#39;,
                &#39;django.contrib.auth.context_processors.auth&#39;,
                &#39;django.contrib.messages.context_processors.messages&#39;,
            ],
        },
    },
]

WSGI_APPLICATION = &#39;drf_test.wsgi.application&#39;


# Database
# https://docs.djangoproject.com/en/1.11/ref/settings/#databases

DATABASES = {
    &#39;default&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,   # 数据库引擎
        &#39;NAME&#39;: &#39;mib&#39;,         # 你要存储数据的库名，事先要创建之
        &#39;USER&#39;: &#39;root&#39;,         # 数据库用户名
        &#39;PASSWORD&#39;: &#39;16745&#39;,     # 密码
        &#39;HOST&#39;: &#39;localhost&#39;,    # IP
        &#39;PORT&#39;: &#39;3306&#39;,         # 数据库使用的端口
    }
}


# Password validation
# https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;,
    },
]


# Internationalization
# https://docs.djangoproject.com/en/1.11/topics/i18n/

LANGUAGE_CODE = &#39;zh-hans&#39;

TIME_ZONE = &#39;Asia/Shanghai&#39;

USE_I18N = True

USE_L10N = True

USE_TZ = False


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/1.11/howto/static-files/

STATIC_URL = &#39;/static/&#39;
STATICFILES_DIRS=(os.path.join(BASE_DIR,&#39;static&#39;),)
AUTH_USER_MODEL = &quot;drf_api.UserInfo&quot;
MEDIA_URL  = &quot;/img/&quot;
MEDIA_ROOT = os.path.join(BASE_DIR, &quot;img&quot;)


# REST_FRAMEWORK = {
#     &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: (
#         &#39;rest_framework.authentication.TokenAuthentication&#39;,
#     )
# }</code></pre>
<h3 id="模型">2.模型</h3>
<pre><code><code>from django.db import models
from django.contrib.auth.models import AbstractUser

from rest_framework import mixins
# Create your models here.
class UserInfo(AbstractUser):
    avatar = models.FileField(upload_to=&#39;avatar/&#39;, default=&#39;avatar/default.png&#39;)
    class Meta:
        verbose_name=&#39;用户表&#39;
        verbose_name_plural = verbose_name


class  Commodity(models.Model):
    name = models.CharField(max_length=60,db_column=&#39;商品名&#39;,null=True)
    inventory = models.IntegerField(db_column=&#39;库存&#39;,null=True)
    cost = models.DecimalField (max_digits=60,decimal_places=2,db_column=&#39;总成本&#39;,null=True)
    selling_price= models.DecimalField (max_digits=60,decimal_places=2,db_column=&#39;总销售价格&#39;,default=0)
    batch = models.CharField(max_length=60, db_column=&#39;批号&#39;, null=True)
    quantity_in = models.IntegerField(db_column=&#39;进货总数量&#39;,null=True)
    sales_volume = models.IntegerField(db_column=&#39;销售量总数量&#39;,default=0)
    return_volume = models.IntegerField(db_column=&#39;退货总数量&#39;,default=0)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    def __str__(self):
        return self.name

    class Meta:
        db_table = &quot;库存表&quot;


class DaySales(models.Model):
    date = models.CharField(max_length=60,db_column=&#39;日期&#39;)
    number = models.DecimalField(max_digits=60, decimal_places=2, db_column=&#39;营业总额&#39;, null=True)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    date_changed = models.DateTimeField(auto_now=True,db_column=&#39;最后修改日期&#39;)
    def __str__(self):
        return self.date
    class Meta:
        db_table = &quot;日销售表&quot;

class DayStock(models.Model):
    date = models.CharField(max_length=60,db_column=&#39;日期&#39;)
    number = models.DecimalField(max_digits=60, decimal_places=2, db_column=&#39;进货总额&#39;, null=True)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    date_changed = models.DateTimeField(auto_now=True,db_column=&#39;最后修改日期&#39;)
    def __str__(self):
        return self.date
    class Meta:
        db_table = &quot;日进货表&quot;

class DayReturn(models.Model):
    date = models.CharField(max_length=60,db_column=&#39;日期&#39;)
    number  = models.DecimalField(max_digits=60, decimal_places=2, db_column=&#39;退货总额&#39;, null=True)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    date_changed = models.DateTimeField(auto_now=True,db_column=&#39;最后修改日期&#39;)
    def __str__(self):
        return self.date
    class Meta:
        db_table = &quot;日退货表&quot;


class CommoditySales(models.Model):
    name = models.CharField(max_length=60,db_column=&#39;商品名&#39;,null=True)
    data = models.ForeignKey(&#39;DaySales&#39;,&#39;id&#39;,db_column=&#39;销售日期&#39;,null=True)
    selling_price= models.DecimalField (max_digits=60,decimal_places=2,db_column=&#39;销售价格&#39;,null=True)
    sales_volume = models.IntegerField(db_column=&#39;销售量数量&#39;,null=True)
    batch = models.CharField(max_length=60,db_column=&#39;批号&#39;,null=True)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    date_changed = models.DateTimeField(auto_now=True,db_column=&#39;最后修改日期&#39;)
    def __str__(self):
        return self.name
    class Meta:
        db_table = &quot;商品销售表&quot;


class CommodityStock(models.Model):
    name = models.CharField(max_length=60,db_column=&#39;商品名&#39;,null=True)
    data = models.ForeignKey(&#39;DayStock&#39;,&#39;id&#39;,db_column=&#39;进货日期&#39;,null=True)
    cost = models.DecimalField (max_digits=60,decimal_places=2,db_column=&#39;单件成本&#39;,null=True)
    Stock_volume = models.IntegerField( db_column=&#39;进货数量&#39;, null=True)
    batch = models.CharField(max_length=60,db_column=&#39;批号&#39;,null=True)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    date_changed = models.DateTimeField(auto_now=True,db_column=&#39;最后修改日期&#39;)
    def __str__(self):
        return self.name
    class Meta:
        db_table = &quot;商品进货表&quot;

class CommodityReturn(models.Model):
    name = models.CharField(max_length=60,db_column=&#39;商品名&#39;,null=True)
    data = models.ForeignKey(&#39;DayReturn&#39;,&#39;id&#39;,db_column=&#39;退货日期&#39;,null=True)
    cost = models.DecimalField (max_digits=60,decimal_places=2,db_column=&#39;退货价格&#39;,null=True)
    return_volume = models.IntegerField( db_column=&#39;退货数量&#39;, null=True)
    batch = models.CharField(max_length=60,db_column=&#39;批号&#39;,null=True)
    is_delete = models.BooleanField(default=False, db_column=&#39;是否删除&#39;)
    date_changed = models.DateTimeField(auto_now=True,db_column=&#39;最后修改日期&#39;)
    def __str__(self):
        return self.name
    class Meta:
        db_table = &quot;商品退货表&quot;</code></pre>
<h3 id="路由">3.路由</h3>
<pre><code><code>&quot;&quot;&quot;drf_test URL Configuration

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/1.11/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  url(r&#39;^$&#39;, views.home, name=&#39;home&#39;)
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  url(r&#39;^$&#39;, Home.as_view(), name=&#39;home&#39;)
Including another URLconf
    1. Import the include() function: from django.conf.urls import url, include
    2. Add a URL to urlpatterns:  url(r&#39;^blog/&#39;, include(&#39;blog.urls&#39;))
&quot;&quot;&quot;
from django.conf.urls import url
from django.contrib import admin
from django_filters import views

from drf_api.views import user
from drf_api.views import commodity
from django.views.static import serve
from .settings import MEDIA_ROOT

urlpatterns = [
    url(r&#39;^admin/&#39;, admin.site.urls),
    url(r&#39;^register/&#39;, user.register),
    url(r&#39;^test/&#39;, user.test),
    url(r&#39;^login/&#39;, user.login),
    url(r&#39;^loginout/&#39;, user.loginout),
    url(r&#39;^get_code/&#39;, user.get_code),
    url(r&#39;^show/&#39;, commodity.Show.as_view()),
    url(r&#39;^add/&#39;, commodity.Add.as_view()),
    url(r&#39;^del/&#39;, commodity.Del.as_view()),
    url(r&#39;^show_del/&#39;, commodity.ShowDel.as_view()),
    url(r&#39;^sales/&#39;, commodity.Sales.as_view()),
    url(r&#39;^return/&#39;, commodity.Return.as_view()),
    url(r&#39;&#39;, user.index),
    url(r&#39;^img/(?P&lt;path&gt;.*)&#39;, serve, {&#39;document_root&#39;: MEDIA_ROOT}),
]
</code></pre>
<h3 id="用户视图">4.用户视图</h3>
<h4 id="user.py">user.py</h4>
<pre><code><code>from django.shortcuts import render,HttpResponse,redirect
from django.http import JsonResponse

from PIL import Image,ImageDraw,ImageFont
import random

from io import BytesIO

from django.contrib import auth

from drf_api.userinfo_form import Register
from drf_api import models
from rest_framework.throttling import SimpleRateThrottle


def test(request):
    return render(request, &#39;aa.html&#39;)



def register(request):
    if request.method==&#39;GET&#39;:
        form=Register()
        return render(request, &#39;register.html&#39;, {&#39;form&#39;:form})
    elif request.is_ajax():
        response={&#39;code&#39;:100,&#39;msg&#39;:None}
        form = Register(request.POST)
        if form.is_valid():
            #校验通过的数据
            clean_data=form.cleaned_data
            #把re_pwd剔除
            clean_data.pop(&#39;re_pwd&#39;)
            #取出头像
            avatar=request.FILES.get(&#39;avatar&#39;)
            if avatar:
                clean_data[&#39;avatar&#39;]=avatar
            user=models.UserInfo.objects.create_user(**clean_data)
            if user:
                response[&#39;msg&#39;] = &#39;创建成功&#39;
            else:
                response[&#39;code&#39;] = 103
                response[&#39;msg&#39;] = &#39;创建失败&#39;
        else:
            response[&#39;code&#39;]=101
            #把校验不通过的数据返回
            response[&#39;msg&#39;]=form.errors
            print(type(form.errors))
        return JsonResponse(response,safe=False)


def login(request):
    if request.method==&#39;GET&#39;:
        return render(request, &#39;login.html&#39;)
    else:
        print(request.POST)
        user_name=request.POST.get(&#39;name&#39;)
        pwd=request.POST.get(&#39;pwd&#39;)
        code=request.POST.get(&#39;code&#39;)

        user=auth.authenticate(username=user_name,password=pwd)
        print(user)
        if request.session.get(&#39;code&#39;).upper() !=code.upper(): #忽略大小写
            return HttpResponse(&#39;验证码错误&#39;)
        elif not user:
            return HttpResponse(&#39;账号密码错误&#39;)
        else:
            auth.login(request,user)
            return redirect(&#39;/show/&#39;)



def get_code(request):
    if request.method == &#39;GET&#39;:
        img = Image.new(&#39;RGB&#39;, (350, 40), (random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
        # 写文字
        # 生成一个字体对象
        font = ImageFont.truetype(&#39;/static/Gabriola.ttf&#39;, 34)
        # 调用方法，返回一个画板对象
        draw = ImageDraw.Draw(img)

        new_text =&#39;&#39;
        x = 100
        # 生成随机4位数字
        text_chiose = &#39;zxcvbnmasdfghjklqwertyup23456789ZXCVBNMASDFGHJKLQWERTYUP&#39;
        text_list=random.sample(text_chiose,4)
        for text in text_list:
            x+=20
            y = random.randint(1,5)
            draw.text((x, y), text, (random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)),
                      font=font)
            new_text +=text



        # 加点线
        width = 320
        height = 35
        for i in range(2):
            x1 = random.randint(0, width)
            x2 = random.randint(0, width)
            y1 = random.randint(0, height)
            y2 = random.randint(0, height)
            # 在图片上画线
            draw.line((x1, y1, x2, y2), fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))

        for i in range(10):
            # 画点
            draw.point([random.randint(0, width), random.randint(0, height)], fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
            x = random.randint(0, width)
            y = random.randint(0, height)
            # 画弧形
            draw.arc((x, y, x + 4, y + 4), 0, 90, fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
        print(new_text)
        #存在session中
        request.session[&#39;code&#39;]=new_text
        #存内存
        f = BytesIO()
        img.save(f, &#39;png&#39;)
        return HttpResponse(f.getvalue())

def loginout(request):
    auth.logout(request)
    return redirect(&#39;/login&#39;)


def index(request):
    return render(request,&#39;index.html&#39;)</code></pre>
<h3 id="商品视图">5.商品视图</h3>
<h4 id="commodity.py">commodity.py</h4>
<p><code>这里Return视图类有点偷懒了里面变量名用的非常非常不规范请见谅</code></p>
<pre><code><code>import datetime

from django.shortcuts import render, HttpResponse
from rest_framework.views import APIView

from drf_api.models import *


class Show(APIView):
    def get(self, request):
        Commodity_list = Commodity.objects.filter(is_delete=False).order_by(&#39;name&#39;).all()
        print(Commodity_list)
        return render(request, &#39;show.html&#39;, {&#39;Commodity_list&#39;: Commodity_list})


class Add(APIView):
    def get(self, request):
        Commodity_list = Commodity.objects.filter(is_delete=False).order_by(&#39;name&#39;).all()
        print(Commodity_list)
        return render(request, &#39;add.html&#39;)

    def post(self, request):
        print(request.POST)
        name = request.POST.get(&#39;name&#39;)  # type:str
        batch = request.POST.get(&#39;batch&#39;)  # type:str
        cost = request.POST.get(&#39;cost&#39;)  # type:str
        Stock_volume = request.POST.get(&#39;Stock_volume&#39;)  # type:str
        time = str(datetime.datetime.now()).split(&#39; &#39;)[0].replace(&#39;-&#39;, &#39;&#39;)

        DayStock_obj = DayStock.objects.filter(date=time).first()

        try:
            number = float(cost) * int(Stock_volume)
        except:
            return HttpResponse(&#39;数量和价格请输入数字&#39;)
        try:
            if not DayStock_obj:
                DayStock_obj = DayStock.objects.create(date=time, number=number)
            else:
                old_number = float(DayStock_obj.number)
                DayStock_obj.number = old_number + number
                DayStock_obj.save()

            CommodityStock_obj = CommodityStock.objects.create(name=name, data=DayStock_obj, cost=number,
                                                               Stock_volume=int(Stock_volume), batch=batch)

            obj = Commodity.objects.filter(is_delete=False, name=name, batch=batch).first()
            if obj:
                obj.quantity_in += int(Stock_volume)
                obj.inventory += int(Stock_volume)
                old_number = float(obj.cost)
                obj.cost = old_number + number
                obj.save()
            else:
                Commodity.objects.create(name=name, inventory=int(Stock_volume), cost=float(cost),
                                         quantity_in=int(Stock_volume), batch=batch)
            return HttpResponse(&#39;添加成功&#39;)
        except:
            return HttpResponse(&#39;添加失败&#39;)


class Del(APIView):

    def get(self, request):
        Commodity_list = Commodity.objects.filter(is_delete=False).order_by(&#39;name&#39;).all()
        print(Commodity_list)
        return render(request, &#39;del.html&#39;, {&#39;Commodity_list&#39;: Commodity_list})

    def post(self, request):
        c_id = request.POST.get(&#39;c_id&#39;)
        Commodity_obj = Commodity.objects.filter(id=c_id).first()
        Commodity_obj.is_delete = True
        Commodity_obj.save()
        return HttpResponse(&#39;删除成功&#39;)


class ShowDel(APIView):

    def get(self, request):
        Commodity_list = Commodity.objects.filter(is_delete=True).all()
        print(Commodity_list)
        return render(request, &#39;show_del.html&#39;, {&#39;Commodity_list&#39;: Commodity_list})

    def post(self, request):
        c_id = request.POST.get(&#39;c_id&#39;)
        Commodity_obj = Commodity.objects.filter(id=c_id).first()
        Commodity_obj.is_delete = False
        Commodity_obj.save()
        return HttpResponse(&#39;恢复成功&#39;)


class Sales(APIView):

    def get(self, request):
        Commodity_list = Commodity.objects.filter(is_delete=False).order_by(&#39;name&#39;).all()
        print(Commodity_list)
        return render(request, &#39;sales.html&#39;, {&#39;Commodity_list&#39;: Commodity_list})

    def post(self, request):
        c_id = request.POST.get(&#39;c_id&#39;)
        selling_price = request.POST.get(&#39;selling_price&#39;)
        sales_volume = request.POST.get(&#39;sales_volume&#39;)
        try:
            selling_price = float(selling_price)
            sales_volume = int(sales_volume)
        except:
            return HttpResponse(&#39;数量和价格请输入数字&#39;)

        try:
            Commodity_obj = Commodity.objects.filter(id=c_id).first()
            name = Commodity_obj.name
            batch = Commodity_obj.batch
            time = str(datetime.datetime.now()).split(&#39; &#39;)[0].replace(&#39;-&#39;, &#39;&#39;)

            DaySales_obj = DaySales.objects.filter(date=time).first()

            number = selling_price * sales_volume

            if not DaySales_obj:
                DaySales_obj = DaySales.objects.create(date=time, number=number)
            else:
                old_number = float(Commodity_obj.selling_price)
                DaySales_obj.number = old_number + number
                DaySales_obj.save()

            CommoditySales_obj = CommoditySales.objects.create(name=name, data=DaySales_obj, selling_price=selling_price,
                                                               sales_volume=sales_volume, batch=batch)

            Commodity_obj.sales_volume += sales_volume
            Commodity_obj.inventory -= sales_volume
            old_number = float(Commodity_obj.selling_price)
            Commodity_obj.selling_price = old_number + number
            Commodity_obj.save()
            return HttpResponse(&#39;出售成功&#39;)
        except:
            return HttpResponse(&#39;数据异常&#39;)


class Return(APIView):

    def get(self, request):
        Commodity_list = Commodity.objects.filter(is_delete=False).order_by(&#39;name&#39;).all()
        print(Commodity_list)
        return render(request, &#39;return.html&#39;, {&#39;Commodity_list&#39;: Commodity_list})

    def post(self, request):
        c_id = request.POST.get(&#39;c_id&#39;)
        selling_price = request.POST.get(&#39;selling_price&#39;)
        sales_volume = request.POST.get(&#39;sales_volume&#39;)
        try:
            selling_price = float(selling_price)
            sales_volume = int(sales_volume)
        except:
            return HttpResponse(&#39;数量和价格请输入数字&#39;)

        try:
            Commodity_obj = Commodity.objects.filter(id=c_id).first()
            name = Commodity_obj.name
            batch = Commodity_obj.batch
            time = str(datetime.datetime.now()).split(&#39; &#39;)[0].replace(&#39;-&#39;, &#39;&#39;)

            DayReturn_obj = DayReturn.objects.filter(date=time).first()

            number = selling_price * sales_volume

            if not DayReturn_obj:
                DayReturn_obj = DayReturn.objects.create(date=time, number=number)
            else:
                old_number = float(Commodity_obj.selling_price)
                DayReturn_obj.number = old_number + number
                DayReturn_obj.save()

            CommodityReturn_obj = CommodityReturn.objects.create(name=name, data=DayReturn_obj, cost=selling_price,
                                                               return_volume=sales_volume, batch=batch)

            Commodity_obj.return_volume += sales_volume
            Commodity_obj.inventory -= sales_volume
            old_number = float(Commodity_obj.selling_price)
            Commodity_obj.selling_price = old_number + number
            Commodity_obj.save()
            return HttpResponse(&#39;退货成功&#39;)
        except:
            return HttpResponse(&#39;数据异常&#39;)</code></pre>
<h3 id="网页">6.网页</h3>
<h4 id="模板template.html">模板template.html</h4>
<pre class="html"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/bootstrap-3.3.7-dist/css/bootstrap.min.css&quot;&gt;
    &lt;script src=&quot;/static/jquery-3.4.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/static/bootstrap-3.3.7-dist/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;title&gt;{% block title_text %}{% endblock %}&lt;/title&gt;
&lt;/head&gt;
&lt;style&gt;
    table{
            background: antiquewhite;
    }
    .header {
        position: fixed;
        top: 0;
        left: 0;
        height: 100px;
        width: 100%;
        background: red;
    }

    .header_left {

        position: absolute;
        line-height: 100px;
        font-size: 50px;
        width: 20%;
        text-align: center;
        background: black;
        color: white;
    }
        .header_middle {
        position: absolute;
        line-height: 100px;
        font-size: 50px;
        width: 20%;
        background: none;
        color: white;
        left: 20%;
    }

    .header_right {
        float: right;
    }

    .body {
        position: fixed;
        top: 100px;
        left: 0;
        bottom: 20px;
        width: 100%;
    }

    .body_left {
        position: fixed;
        top: 100px;
        bottom: 20px;
        width: 20%;
        background: white;
        left: 0;
    }

    .body_right {
        overflow: auto;
        position: fixed;
        top: 100px;
        left: 20%;
        bottom: 20px;
        width: 80%;
        background: #2aabd2;
    }

    .footer {
        position: fixed;
        left: 0;
        bottom: 0;
        height: 20px;
        width: 100%;
        background: black;
    }
&lt;/style&gt;
{% block new_css %}
{% endblock %}
&lt;body&gt;

&lt;div class=&quot;header&quot;&gt;
    &lt;div class=&quot;header_left&quot;&gt;管理系统&lt;/div&gt;
    &lt;div class=&quot;header_middle&quot;&gt;&lt;span id=&quot;clock&quot;&gt;&lt;/span&gt;&lt;/div&gt;
    &lt;div class=&quot;header_right&quot;&gt;
        {% if request.user.is_authenticated %}
            &lt;span&gt;&lt;img src=http://127.0.0.1:8000/img/{{ request.user.avatar }} alt=&quot;&quot; style=&quot;height: 30px;width: 30px&quot;&gt;尊敬的{{ request.user.username }}&lt;/span&gt;
            &lt;span class=&quot;dropdown&quot;&gt;
  &lt;button class=&quot;btn btn-default dropdown-toggle&quot; type=&quot;button&quot; id=&quot;dropdownMenu1&quot; data-toggle=&quot;dropdown&quot;
          aria-haspopup=&quot;true&quot; aria-expanded=&quot;true&quot; style=&quot;font-size: 12px&quot;&gt;
    更多操作
    &lt;span class=&quot;caret&quot;&gt;&lt;/span&gt;
  &lt;/button&gt;
  &lt;ul class=&quot;dropdown-menu&quot; aria-labelledby=&quot;dropdownMenu1&quot; &gt;
    &lt;li&gt;&lt;a href=&quot;#&quot; style=&quot;line-height: 0.428571;&quot;&gt;修改头像&lt;/a&gt;&lt;a href=&quot;#&quot;&gt;修改密码&lt;/a&gt;&lt;/li&gt;
    &lt;li role=&quot;separator&quot; class=&quot;divider&quot;&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;/loginout/&quot; style=&quot;line-height: 0.428571;&quot;&gt;登出&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/span&gt;
        {% else %}
            &lt;spen style=&quot;line-height: 50px;float: right;position: absolute;right: 120px;&quot;&gt;&lt;a
                    href=&quot;/login/&quot;&gt;登入&lt;/a&gt;{{ request.user.username }}&lt;/spen&gt;
            &lt;spen style=&quot;line-height: 50px;float: right;position: absolute;right: 80px;&quot;&gt;&lt;a
                    href=&quot;/register/&quot;&gt;注册&lt;/a&gt;{{ request.user.username }}&lt;/spen&gt;
        {% endif %}
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;body&quot;&gt;
    &lt;div class=&quot;body_left&quot;&gt;
        &lt;ul class=&quot;nav nav-pills nav-stacked nav-pills-stacked-example&quot;&gt;
            &lt;li role=&quot;presentation&quot; class=&quot;active&quot;&gt;&lt;a&gt;库存管理&lt;/a&gt;&lt;/li&gt;
            &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;/show/&quot;&gt;商品库存&lt;/a&gt;&lt;/li&gt;
            &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;/add/&quot;&gt;商品进货&lt;/a&gt;&lt;/li&gt;
            &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;/return/&quot;&gt;商品退货&lt;/a&gt;&lt;/li&gt;
            &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;/sales/&quot;&gt;商品销售&lt;/a&gt;&lt;/li&gt;
            &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;/del/&quot;&gt;删除库存商品&lt;/a&gt;&lt;/li&gt;
            &lt;li role=&quot;presentation&quot;&gt;&lt;a href=&quot;/show_del/&quot;&gt;删除商品查看&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;

    &lt;/div&gt;
    &lt;div class=&quot;body_right&quot;&gt;
        {% block data %}
        {% endblock %}
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;footer&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;script&gt;
    function get_time() {
        var obj = new Date();
        var hour = obj.getHours();
        var min = obj.getMinutes();
        var seconds = obj.getSeconds();
        if (parseInt(seconds)&lt;10)seconds=&#39;0&#39;+seconds;
        if (parseInt(hour)&lt;10)hour=&#39;0&#39;+hour;
        if (parseInt(min)&lt;10)min=&#39;0&#39;+min;
        var time = hour + &#39;:&#39; + min + &#39;:&#39; + seconds
        var clock = document.querySelector(&#39;#clock&#39;)
        clock.innerText = time
    }
    setInterval(get_time,1000)
&lt;/script&gt;
{% block new_js %}
{% endblock %}</code></pre>
<h4 id="注册register.html">注册register.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    注册
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-6 col-md-offset-3&quot;&gt;

                &lt;h1&gt;注册&lt;/h1&gt;
                &lt;form id=&quot;my_form&quot;&gt;
                    {% for foo in form %}
                        &lt;div class=&quot;form-group&quot;&gt;
                            {#foo.auto_id   就是foo生成的input的id#}
                            &lt;label for=&quot;{{ foo.auto_id }}&quot;&gt;{{ foo.label }}&lt;/label&gt;
                            {{ foo }} &lt;span style=&quot;color: red&quot; class=&quot;error pull-right&quot;&gt;&lt;/span&gt;
                        &lt;/div&gt;

                    {% endfor %}
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;id_file&quot;&gt;头像
                            &lt;img src=&quot;/img/avatar/default.png&quot; width=&quot;80&quot; height=&quot;80&quot; style=&quot;margin-left: 20px&quot;
                                 id=&quot;id_img&quot;&gt;
                        &lt;/label&gt;


                        &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;id_file&quot; style=&quot;display: none&quot;&gt;
                    &lt;/div&gt;
                    &lt;input type=&quot;button&quot; class=&quot;btn btn-success&quot; value=&quot;提交&quot; id=&quot;id_submit&quot;&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        //当该控件发生变化，响应该事件
        $(&quot;#id_file&quot;).change(function () {
            //alert(1)
            //取到文件对象
            var file = $(&quot;#id_file&quot;)[0].files[0]
            //放到img控件上，借助于filereader 中间的东西，文件阅读器
            //生成一个文件阅读器对象赋值给filereader
            var filereader = new FileReader()
            //把文件读到filereader对象中
            //读文件需要时间，需要文件读完再去操作img
            filereader.readAsDataURL(file)

            filereader.onload = function () {
                $(&quot;#id_img&quot;).attr(&#39;src&#39;, filereader.result)
            }

        })
        $(&quot;#id_submit&quot;).click(function () {

            //ajax 上传文件


            var formdata = new FormData()
            //一个一个往里添加，稍微复杂，用简便方法
            // formdata.append(&#39;name&#39;,$(&quot;#id_name&quot;).val())
            // formdata.append(&#39;pwd&#39;,$(&quot;#id_pwd&quot;).val())

            //简便方法
            //form 对象的serializeArray，它会把form中的数据包装到一个对象中（不包含文件）
            var my_form_data = $(&quot;#my_form&quot;).serializeArray()
            //console.log(typeof my_form_data)
            //console.log(my_form_data)
            //jq的循环，传两个参数，第一个是要循环的对象，第二个参数是一个匿名函数
            $.each(my_form_data, function (k, v) {
                {#console.log(k)#}
                {#console.log(v)#}
                formdata.append(v.name, v.value)
            })
            formdata.append(&#39;avatar&#39;, $(&quot;#id_file&quot;)[0].files[0])


            $.ajax({
                url: &#39;/register/&#39;,
                type: &#39;post&#39;,
                processData: false, //告诉jQuery不要去处理发送的数据
                contentType: false,// 告诉jQuery不要去设置Content-Type请求头
                data: formdata,
                success: function (data) {
                    //console.log(data)
                    if (data.code == 100) {
                        location.href = &#39;/login/&#39;
                    } else if (data.code == 101) {
                        $.each(data.msg, function (k, v) {
                            console.log(k)
                            console.log(v)
                            $(&quot;#id_&quot; + k).next().html(v[0])
                            if (k == &#39;__all__&#39;) {
                                $(&quot;#id_re_pwd&quot;).next().html(v[0])
                            }

                        })

                    }
                    //定时器
                    setTimeout(function () {
                        $(&quot;.error&quot;).html(&quot;&quot;)
                    }, 3000)
                }


            })
        })


    &lt;/script&gt;
{% endblock %}</code></pre>
<h4 id="登入login.html">登入login.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    登入
{% endblock %}
{% block new_css %}
    &lt;style&gt;
        .img-code:hover{

        }
    &lt;/style&gt;
{% endblock %}
{% block data %}
    &lt;div class=&quot;container-fluid center-block&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-6 col-md-offset-3&quot;&gt;
                {% csrf_token %}
                &lt;h1&gt;登陆&lt;/h1&gt;
                &lt;form action=&quot;&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;id_name&quot;&gt;用户名&lt;/label&gt;
                        &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;id_name&quot; class=&quot;form-control&quot;&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;pwd&quot;&gt;密码&lt;/label&gt;
                        &lt;input type=&quot;password&quot; name=&quot;pwd&quot; id=&quot;pwd&quot; class=&quot;form-control&quot;&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;id_code&quot;&gt;验证码&lt;/label&gt;
                        &lt;div class=&quot;row&quot;&gt;
                            &lt;div class=&quot;col-md-6&quot;&gt;
                                &lt;input type=&quot;text&quot; name=&quot;code&quot; id=&quot;id_code&quot; class=&quot;form-control&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;col-md-6&quot; id=&quot;img&quot;&gt;
                                &lt;img src=&quot;/get_code/&quot; height=&quot;40&quot; width=&quot;240&quot; class=&quot;img-code&quot;&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;input type=&quot;button&quot; value=&quot;提交&quot; class=&quot;btn-success&quot; id=&quot;up_data&quot;&gt;
                    &lt;span style=&quot;color: red&quot; id=&quot;msg&quot;&gt;&lt;/span&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        $(&#39;.img-code&#39;).click(function () {
            var img_code_src = $(this).attr(&#39;src&#39;);
            img_code_src += &#39;1&#39;;
            console.log(img_code_src);
            $(this).attr(&#39;src&#39;, img_code_src)
        })
    &lt;/script&gt;

    &lt;script&gt;
        $(&#39;#up_data&#39;).click(function () {
            $.ajax({
                type: &#39;post&#39;,
                url: &#39;/login/&#39;,
                data: {
                    &#39;name&#39;: $(&#39;#id_name&#39;).val(),
                    &#39;pwd&#39;: $(&#39;#pwd&#39;).val(),
                    &#39;code&#39;: $(&#39;#id_code&#39;).val(),
                    &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                },
                success: function (msg) {
                    console.log(msg);
                    $(&#39;#msg&#39;).text(msg);
                    if (msg == &#39;登入成功&#39;) {
                        console.log(&#39;sb&#39;);
                    }
                }
            })
        })
    &lt;/script&gt;
{% endblock %}</code></pre>
<h4 id="首页index.html">首页index.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    首页
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;div class=&quot;msg&quot; style=&quot;    font-size: 100px;
    text-align: center;
    color: red;
}&quot;&gt;欢迎光临
    &lt;/div&gt;
{% endblock %}
{% block new_js %}
{% endblock %}</code></pre>
<h4 id="进货add.html">进货add.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    添加商品
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
        {% csrf_token %}
        &lt;label for=&quot;name&quot;&gt;商品名&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot;&gt;
        &lt;label for=&quot;Stock_volume&quot;&gt;商品数量&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;Stock_volume&quot; name=&quot;Stock_volume&quot;&gt;
        &lt;label for=&quot;batch&quot;&gt;商品批号&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;batch&quot; name=&quot;batch&quot;&gt;
        &lt;label for=&quot;cost&quot;&gt;商品单价(元)&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;cost&quot; name=&quot;cost&quot;&gt;
        &lt;input type=&quot;button&quot; value=&quot;提交&quot; class=&quot;custom_button&quot;&gt;
    &lt;/form&gt;
    &lt;div class=&quot;msg&quot;&gt;&lt;/div&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
    var new_show_msg =&#39;&#39;
        var custom_button = document.querySelector(&#39;.custom_button&#39;);
        custom_button.onclick = function () {
            var name = document.querySelector(&#39;#name&#39;).value;
            var Stock_volume = document.querySelector(&#39;#Stock_volume&#39;).value;
            var batch = document.querySelector(&#39;#batch&#39;).value;
            var cost = document.querySelector(&#39;#cost&#39;).value;
            var show_msg = &#39;商品名:&#39; + name + &#39;\n批号:&#39; + batch + &#39;\n数量:&#39; + Stock_volume + &#39;\n成本单价:&#39; + cost+&#39;元&#39;
            if (name &amp;&amp; Stock_volume &amp;&amp; batch &amp;&amp; cost) {
                if (confirm(show_msg)){
                    $.ajax(
                        {
                            type: &#39;post&#39;,
                            url: &#39;/add/&#39;,
                            data: {
                                &#39;name&#39;: name,
                                &#39;Stock_volume&#39;: Stock_volume,
                                &#39;batch&#39;: batch,
                                &#39;cost&#39;: cost,
                                &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                            }, success: function (msg) {
                                var show = document.querySelector(&#39;.msg&#39;)
                                new_show_msg += &#39;&lt;div style=&quot;white-space: pre-line;border: 2px solid;position: inherit;&quot;&gt;&lt;div style=&quot;color:red&quot;&gt;&#39;+msg+&#39;&lt;/div&gt;&#39;+show_msg+&#39;&lt;/div&gt;&#39;
                                show.innerHTML=new_show_msg
                            }
                        }
                    )
                }
            } else {
                alert(&#39;内容不能为空&#39;)
            }


        }
    &lt;/script&gt;

{% endblock %}</code></pre>
<h4 id="销售sales.html">销售sales.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    删除商品库存
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;table class=&quot;table table-hover&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;/th&gt;
            &lt;th&gt;商品名&lt;/th&gt;
            &lt;th&gt;商品批号&lt;/th&gt;
            &lt;th&gt;库存&lt;/th&gt;
            &lt;th&gt;总成本&lt;/th&gt;
            &lt;th&gt;总销售额&lt;/th&gt;
            &lt;th&gt;进货总数量&lt;/th&gt;
            &lt;th&gt;销售量总数量&lt;/th&gt;
            &lt;th&gt;退货总数量&lt;/th&gt;
            &lt;th&gt;销售&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for Commodity_obj in Commodity_list %}
            &lt;tr&gt;
                &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
                &lt;td&gt;{{ Commodity_obj.name }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.batch }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.inventory }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.cost }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.selling_price }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.quantity_in }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.sales_volume }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.return_volume }}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&quot;del_button&quot; inventory={{ Commodity_obj.inventory }} batch={{ Commodity_obj.batch }} c_id={{ Commodity_obj.id }}&gt;出售&lt;/button&gt;
                &lt;/td&gt;

            &lt;/tr&gt;
        {% endfor %}


        &lt;/tbody&gt;
    &lt;/table&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        var del_button = document.querySelectorAll(&#39;.del_button&#39;)
        for (var index = 0; index &lt; del_button.length; index++) {
            del_button[index].onclick = function () {
                if (confirm(&#39;是否确定出售&#39;)) {
                    var selling_price = parseFloat(prompt(&#39;出售价格&#39;));
                    var sales_volume = parseInt(prompt(&#39;出售数量&#39;));
                    var c_id = this.getAttribute(&#39;c_id&#39;);
                    var inventory = this.getAttribute(&#39;inventory&#39;);
                    if(sales_volume&lt;=inventory){
                                 $.ajax({
                        url: /sales/,
                        type: &#39;post&#39;,
                        data: {
                            &#39;c_id&#39;: c_id,
                            &#39;selling_price&#39;: selling_price,
                            &#39;sales_volume&#39;: sales_volume,
                            &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                        },
                        success: function (msg) {
                            alert(msg)
                            window.location.replace(&#39;/sales/&#39;)
                    }
                    })
                    }else {
                        alert(&#39;库存不足&#39;)
                    }

                }
            }
        }
    &lt;/script&gt;
{% endblock %}</code></pre>
<h4 id="退货return.html">退货return.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    删除商品库存
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;table class=&quot;table table-hover&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;/th&gt;
            &lt;th&gt;商品名&lt;/th&gt;
            &lt;th&gt;商品批号&lt;/th&gt;
            &lt;th&gt;库存&lt;/th&gt;
            &lt;th&gt;总成本&lt;/th&gt;
            &lt;th&gt;总销售额&lt;/th&gt;
            &lt;th&gt;进货总数量&lt;/th&gt;
            &lt;th&gt;销售量总数量&lt;/th&gt;
            &lt;th&gt;退货总数量&lt;/th&gt;
            &lt;th&gt;退货&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for Commodity_obj in Commodity_list %}
            &lt;tr&gt;
                &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
                &lt;td&gt;{{ Commodity_obj.name }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.batch }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.inventory }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.cost }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.selling_price }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.quantity_in }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.sales_volume }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.return_volume }}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&quot;del_button&quot; inventory={{ Commodity_obj.inventory }} batch={{ Commodity_obj.batch }} c_id={{ Commodity_obj.id }}&gt;退货&lt;/button&gt;
                &lt;/td&gt;

            &lt;/tr&gt;
        {% endfor %}


        &lt;/tbody&gt;
    &lt;/table&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        var del_button = document.querySelectorAll(&#39;.del_button&#39;)
        for (var index = 0; index &lt; del_button.length; index++) {
            del_button[index].onclick = function () {
                if (confirm(&#39;是否确定退货&#39;)) {
                    var selling_price = parseFloat(prompt(&#39;退货单价&#39;));
                    var sales_volume = parseInt(prompt(&#39;退货数量&#39;));
                    var c_id = this.getAttribute(&#39;c_id&#39;);
                    var inventory = this.getAttribute(&#39;inventory&#39;);
                    if(sales_volume&lt;=inventory){
                                 $.ajax({
                        url: /return/,
                        type: &#39;post&#39;,
                        data: {
                            &#39;c_id&#39;: c_id,
                            &#39;selling_price&#39;: selling_price,
                            &#39;sales_volume&#39;: sales_volume,
                            &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                        },
                        success: function (msg) {
                            alert(msg)
                            window.location.replace(&#39;/return/&#39;)
                    }
                    })
                    }else {
                        alert(&#39;库存不足&#39;)
                    }

                }
            }
        }
    &lt;/script&gt;
{% endblock %}</code></pre>
<h4 id="删除商品del.html">删除商品del.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    删除商品库存
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;table class=&quot;table table-hover&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;/th&gt;
            &lt;th&gt;商品名&lt;/th&gt;
            &lt;th&gt;商品批号&lt;/th&gt;
            &lt;th&gt;库存库存&lt;/th&gt;
            &lt;th&gt;总成本&lt;/th&gt;
            &lt;th&gt;总销售额&lt;/th&gt;
            &lt;th&gt;进货总数量&lt;/th&gt;
            &lt;th&gt;销售量总数量&lt;/th&gt;
            &lt;th&gt;退货总数量&lt;/th&gt;
            &lt;th&gt;是否删除&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for Commodity_obj in Commodity_list %}
            &lt;tr&gt;
                &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
                &lt;td&gt;{{ Commodity_obj.name }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.batch }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.inventory }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.cost }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.selling_price }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.quantity_in }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.sales_volume }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.return_volume }}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&quot;del_button&quot; c_id={{ Commodity_obj.id }}&gt;删除&lt;/button&gt;
                &lt;/td&gt;

            &lt;/tr&gt;
        {% endfor %}


        &lt;/tbody&gt;
    &lt;/table&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        var del_button = document.querySelectorAll(&#39;.del_button&#39;)
        for (var index = 0; index &lt; del_button.length; index++) {
            del_button[index].onclick = function () {
                if (confirm(&#39;是否确定删除&#39;)) {
                    var c_id = this.getAttribute(&#39;c_id&#39;);
                    $.ajax({
                        url: /del/,
                        type: &#39;post&#39;,
                        data: {
                            &#39;c_id&#39;: c_id,
                            &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                        },
                        success: function (msg) {
                            alert(msg)
                            window.location.replace(&#39;/del/&#39;)
                    }
                    })
                }
            }
        }
    &lt;/script&gt;
{% endblock %}</code></pre>
<h4 id="展示show.html">展示show.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    查看商品
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
&lt;table class=&quot;table table-hover&quot;&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;商品名&lt;/th&gt;
          &lt;th&gt;批号&lt;/th&gt;
          &lt;th&gt;库存库存&lt;/th&gt;
          &lt;th&gt;总成本&lt;/th&gt;
          &lt;th&gt;总销售额&lt;/th&gt;
          &lt;th&gt;进货总数量&lt;/th&gt;
          &lt;th&gt;销售量总数量&lt;/th&gt;
          &lt;th&gt;退货总数量&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        {% for Commodity_obj in Commodity_list %}
            &lt;tr&gt;
          &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
          &lt;td&gt;{{ Commodity_obj.name}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.batch}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.inventory}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.cost}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.selling_price}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.quantity_in}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.sales_volume}}&lt;/td&gt;
          &lt;td&gt;{{ Commodity_obj.return_volume}}&lt;/td&gt;

        &lt;/tr&gt;
        {% endfor %}


      &lt;/tbody&gt;
    &lt;/table&gt;
{% endblock %}
{% block new_js %}
{% endblock %}</code></pre>
<h4 id="展示删除show_del.html">展示删除show_del.html</h4>
<pre><code><code>{% extends &#39;template.html&#39; %}
{% block title_text %}
    删除商品查看及还原
{% endblock %}
{% block new_css %}
{% endblock %}
{% block data %}
    &lt;table class=&quot;table table-hover&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;/th&gt;
            &lt;th&gt;商品名&lt;/th&gt;
            &lt;th&gt;商品批号&lt;/th&gt;
            &lt;th&gt;库存库存&lt;/th&gt;
            &lt;th&gt;总成本&lt;/th&gt;
            &lt;th&gt;总销售额&lt;/th&gt;
            &lt;th&gt;进货总数量&lt;/th&gt;
            &lt;th&gt;销售量总数量&lt;/th&gt;
            &lt;th&gt;退货总数量&lt;/th&gt;
            &lt;th&gt;是否还原&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for Commodity_obj in Commodity_list %}
            &lt;tr&gt;
                &lt;th scope=&quot;row&quot;&gt;1&lt;/th&gt;
                &lt;td&gt;{{ Commodity_obj.name }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.batch }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.inventory }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.cost }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.selling_price }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.quantity_in }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.sales_volume }}&lt;/td&gt;
                &lt;td&gt;{{ Commodity_obj.return_volume }}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&quot;del_button&quot; c_id={{ Commodity_obj.id }}&gt;还原&lt;/button&gt;
                &lt;/td&gt;

            &lt;/tr&gt;
        {% endfor %}


        &lt;/tbody&gt;
    &lt;/table&gt;
{% endblock %}
{% block new_js %}
    &lt;script&gt;
        var del_button = document.querySelectorAll(&#39;.del_button&#39;)
        for (var index = 0; index &lt; del_button.length; index++) {
            del_button[index].onclick = function () {
                if (confirm(&#39;是否确定还原&#39;)) {
                    var c_id = this.getAttribute(&#39;c_id&#39;);
                    $.ajax({
                        url: /show_del/,
                        type: &#39;post&#39;,
                        data: {
                            &#39;c_id&#39;: c_id,
                            &#39;csrfmiddlewaretoken&#39;: &#39;{{csrf_token}}&#39;
                        },
                        success: function (msg) {
                            alert(msg)
                            window.location.replace(&#39;/show_del/&#39;)
                    }
                    })
                }
            }
        }
    &lt;/script&gt;
{% endblock %}</code></pre>
<h2 id="五.自动生成项目目录树状图">五.自动生成项目目录树状图</h2>
<pre><code><code>import os
def dirsTree():
    PATH = os.path.dirname(__file__)
    print(PATH)
    lis = os.listdir(PATH)
    if lis != None:
        for a in lis:
            print(f&#39;|___{a}&#39;)
            if &#39;.&#39; not in a:
                a_path = os.path.join(PATH,a)
                lis_2 = os.listdir(a_path)
                if lis_2 != None:
                    for b in lis_2:
                        if b != &#39;__pycache__&#39;:
                            print(f&#39;|    |___{b}&#39;)
if __name__ == &#39;__main__&#39;:                  
    dirsTree()
 #弄了两级也没有用递归来做啦</code></pre>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>